import{l as b}from"./CollectionFlattener-459cb615.js";import{e as l,y as p,a as u,j as f,bh as c,aj as m,aT as g,s as d}from"./index-c754ff65.js";function L(o){return new b({getCollections:()=>[o.tables,o.layers],getChildrenFunction:a=>{const s=[];return"tables"in a&&s.push(a.tables),"layers"in a&&s.push(a.layers),s},itemFilterFunction:a=>{const s=a.parent;return!!s&&"tables"in s&&s.tables.includes(a)}})}function y(o,a,s){let e,t;if(o)for(let n=0,i=o.length;n<i;n++){if(e=o.getItemAt(n),e[a]===s)return e;if((e==null?void 0:e.type)==="group"&&(t=y(e.layers,a,s),t))return t}}const x=o=>{let a=class extends o{constructor(...e){super(...e),this.layers=new f;const t=r=>{r.parent&&"remove"in r.parent&&r.parent.remove(r)},n=r=>{r.parent=this,this.layerAdded(r),r.type!=="elevation"&&r.type!=="base-elevation"||d.getLogger(this.declaredClass).error(`Layer 'title:${r.title}, id:${r.id}' of type '${r.type}' is not supported as an operational layer and will therefore be ignored.`)},i=r=>{r.parent=null,this.layerRemoved(r)};this.layers.on("before-add",r=>t(r.item)),this.layers.on("after-add",r=>n(r.item)),this.layers.on("after-remove",r=>i(r.item))}destroy(){const e=this.layers.removeAll();for(const t of e)this.layerRemoved(t),t.destroy();this.layers.destroy()}set layers(e){this._set("layers",c(e,this._get("layers")))}add(e,t){const n=this.layers;if(t=n.getNextIndex(t),e instanceof m){const i=e;i.parent===this?this.reorder(i,t):n.add(i,t)}else g(e)?e.then(i=>{this.destroyed||this.add(i,t)}):d.getLogger(this.declaredClass).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(e,t){const n=this.layers;let i=n.getNextIndex(t);e.slice().forEach(r=>{r.parent!==this?(n.add(r,i),i+=1):this.reorder(r,i)})}findLayerById(e){return y(this.layers,"id",e)}findLayerByUid(e){return y(this.layers,"uid",e)}remove(e){return this.layers.remove(e)}removeMany(e){return this.layers.removeMany(e)}removeAll(){return this.layers.removeAll()}reorder(e,t){return this.layers.reorder(e,t)}layerAdded(e){}layerRemoved(e){}};return l([p()],a.prototype,"layers",null),a=l([u("esri.support.LayersMixin")],a),a};function h(o,a,s){if(o)for(let e=0,t=o.length;e<t;e++){const n=o.getItemAt(e);if(n[a]===s)return n;if((n==null?void 0:n.type)==="group"){const i=h(n.tables,a,s);if(i)return i}}}const C=o=>{let a=class extends o{constructor(...s){super(...s),this.tables=new f,this.tables.on("after-add",e=>{const t=e.item;t.parent&&t.parent!==this&&"tables"in t.parent&&t.parent.tables.remove(t),t.parent=this,t.type!=="feature"&&d.getLogger(this.declaredClass).error(`Layer 'title:${t.title}, id:${t.id}' of type '${t.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",e=>{e.item.parent=null})}destroy(){const s=this.tables.removeAll();for(const e of s)e.destroy();this.tables.destroy()}set tables(s){this._set("tables",c(s,this._get("tables")))}findTableById(s){return h(this.tables,"id",s)}findTableByUid(s){return h(this.tables,"uid",s)}};return l([p()],a.prototype,"tables",null),a=l([u("esri.support.TablesMixin")],a),a};export{x as d,C as l,L as t};
