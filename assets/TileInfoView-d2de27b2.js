import{ac as V,n as E,av as Z,cX as J,aq as K,ar as Q,g as G,aT as H,at as U,aP as tt,c as et,cY as st,cZ as it,a3 as rt,ab as ot,aZ as W}from"./index-1de34779.js";import{f as nt}from"./quickselect-56c5966e.js";import{u as lt}from"./aaBoundingRect-da6cd5b1.js";import{e as $}from"./TileKey-d02c5724.js";function C(i,t){if(!(this instanceof C))return new C(i,t);this._maxEntries=Math.max(4,i||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&(typeof t=="function"?this.toBBox=t:this._initFormat(t)),this.clear()}function ht(i,t,e){if(!e)return t.indexOf(i);for(var s=0;s<t.length;s++)if(e(i,t[s]))return s;return-1}function X(i,t){F(i,0,i.children.length,t,i)}function F(i,t,e,s,r){r||(r=Y(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var n,o=t;o<e;o++)n=i.children[o],S(r,i.leaf?s(n):n);return r}function S(i,t){return i.minX=Math.min(i.minX,t.minX),i.minY=Math.min(i.minY,t.minY),i.maxX=Math.max(i.maxX,t.maxX),i.maxY=Math.max(i.maxY,t.maxY),i}function A(i,t){return i.minX-t.minX}function N(i,t){return i.minY-t.minY}function R(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function I(i){return i.maxX-i.minX+(i.maxY-i.minY)}function at(i,t){return(Math.max(t.maxX,i.maxX)-Math.min(t.minX,i.minX))*(Math.max(t.maxY,i.maxY)-Math.min(t.minY,i.minY))}function ct(i,t){var e=Math.max(i.minX,t.minX),s=Math.max(i.minY,t.minY),r=Math.min(i.maxX,t.maxX),n=Math.min(i.maxY,t.maxY);return Math.max(0,r-e)*Math.max(0,n-s)}function T(i,t){return i.minX<=t.minX&&i.minY<=t.minY&&t.maxX<=i.maxX&&t.maxY<=i.maxY}function b(i,t){return t.minX<=i.maxX&&t.minY<=i.maxY&&t.maxX>=i.minX&&t.maxY>=i.minY}function Y(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function j(i,t,e,s,r){for(var n,o=[t,e];o.length;)(e=o.pop())-(t=o.pop())<=s||(n=t+Math.ceil((e-t)/s/2)*s,nt(i,n,t,e,r),o.push(t,n,n,e))}C.prototype={all:function(){return this._all(this.data,[])},search:function(i){var t=this.data,e=[],s=this.toBBox;if(!b(i,t))return e;for(var r,n,o,l,h=[];t;){for(r=0,n=t.children.length;r<n;r++)o=t.children[r],b(i,l=t.leaf?s(o):o)&&(t.leaf?e.push(o):T(i,l)?this._all(o,e):h.push(o));t=h.pop()}return e},collides:function(i){var t=this.data,e=this.toBBox;if(!b(i,t))return!1;for(var s,r,n,o,l=[];t;){for(s=0,r=t.children.length;s<r;s++)if(n=t.children[s],b(i,o=t.leaf?e(n):n)){if(t.leaf||T(i,o))return!0;l.push(n)}t=l.pop()}return!1},load:function(i){if(!i||!i.length)return this;if(i.length<this._minEntries){for(var t=0,e=i.length;t<e;t++)this.insert(i[t]);return this}var s=this._build(i.slice(),0,i.length-1,0);if(this.data.children.length)if(this.data.height===s.height)this._splitRoot(this.data,s);else{if(this.data.height<s.height){var r=this.data;this.data=s,s=r}this._insert(s,this.data.height-s.height-1,!0)}else this.data=s;return this},insert:function(i){return i&&this._insert(i,this.data.height-1),this},clear:function(){return this.data=Y([]),this},remove:function(i,t){if(!i)return this;for(var e,s,r,n,o=this.data,l=this.toBBox(i),h=[],a=[];o||h.length;){if(o||(o=h.pop(),s=h[h.length-1],e=a.pop(),n=!0),o.leaf&&(r=ht(i,o.children,t))!==-1)return o.children.splice(r,1),h.push(o),this._condense(h),this;n||o.leaf||!T(o,l)?s?(e++,o=s.children[e],n=!1):o=null:(h.push(o),a.push(e),e=0,s=o,o=o.children[0])}return this},toBBox:function(i){return i},compareMinX:A,compareMinY:N,toJSON:function(){return this.data},fromJSON:function(i){return this.data=i,this},_all:function(i,t){for(var e=[];i;)i.leaf?t.push.apply(t,i.children):e.push.apply(e,i.children),i=e.pop();return t},_build:function(i,t,e,s){var r,n=e-t+1,o=this._maxEntries;if(n<=o)return X(r=Y(i.slice(t,e+1)),this.toBBox),r;s||(s=Math.ceil(Math.log(n)/Math.log(o)),o=Math.ceil(n/Math.pow(o,s-1))),(r=Y([])).leaf=!1,r.height=s;var l,h,a,c,u=Math.ceil(n/o),_=u*Math.ceil(Math.sqrt(o));for(j(i,t,e,_,this.compareMinX),l=t;l<=e;l+=_)for(j(i,l,a=Math.min(l+_-1,e),u,this.compareMinY),h=l;h<=a;h+=u)c=Math.min(h+u-1,a),r.children.push(this._build(i,h,c,s-1));return X(r,this.toBBox),r},_chooseSubtree:function(i,t,e,s){for(var r,n,o,l,h,a,c,u;s.push(t),!t.leaf&&s.length-1!==e;){for(c=u=1/0,r=0,n=t.children.length;r<n;r++)h=R(o=t.children[r]),(a=at(i,o)-h)<u?(u=a,c=h<c?h:c,l=o):a===u&&h<c&&(c=h,l=o);t=l||t.children[0]}return t},_insert:function(i,t,e){var s=this.toBBox,r=e?i:s(i),n=[],o=this._chooseSubtree(r,this.data,t,n);for(o.children.push(i),S(o,r);t>=0&&n[t].children.length>this._maxEntries;)this._split(n,t),t--;this._adjustParentBBoxes(r,n,t)},_split:function(i,t){var e=i[t],s=e.children.length,r=this._minEntries;this._chooseSplitAxis(e,r,s);var n=this._chooseSplitIndex(e,r,s),o=Y(e.children.splice(n,e.children.length-n));o.height=e.height,o.leaf=e.leaf,X(e,this.toBBox),X(o,this.toBBox),t?i[t-1].children.push(o):this._splitRoot(e,o)},_splitRoot:function(i,t){this.data=Y([i,t]),this.data.height=i.height+1,this.data.leaf=!1,X(this.data,this.toBBox)},_chooseSplitIndex:function(i,t,e){var s,r,n,o,l,h,a,c;for(h=a=1/0,s=t;s<=e-t;s++)o=ct(r=F(i,0,s,this.toBBox),n=F(i,s,e,this.toBBox)),l=R(r)+R(n),o<h?(h=o,c=s,a=l<a?l:a):o===h&&l<a&&(a=l,c=s);return c},_chooseSplitAxis:function(i,t,e){var s=i.leaf?this.compareMinX:A,r=i.leaf?this.compareMinY:N;this._allDistMargin(i,t,e,s)<this._allDistMargin(i,t,e,r)&&i.children.sort(s)},_allDistMargin:function(i,t,e,s){i.children.sort(s);var r,n,o=this.toBBox,l=F(i,0,t,o),h=F(i,e-t,e,o),a=I(l)+I(h);for(r=t;r<e-t;r++)n=i.children[r],S(l,i.leaf?o(n):n),a+=I(l);for(r=e-t-1;r>=t;r--)n=i.children[r],S(h,i.leaf?o(n):n),a+=I(h);return a},_adjustParentBBoxes:function(i,t,e){for(var s=e;s>=0;s--)S(t[s],i)},_condense:function(i){for(var t,e=i.length-1;e>=0;e--)i[e].children.length===0?e>0?(t=i[e-1].children).splice(t.indexOf(i[e]),1):this.clear():X(i[e],this.toBBox)},_initFormat:function(i){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(i[0])),this.compareMinY=new Function("a","b",t.join(i[1])),this.toBBox=new Function("a","return {minX: a"+i[0]+", minY: a"+i[1]+", maxX: a"+i[2]+", maxY: a"+i[3]+"};")}};class ut{constructor(t,e){this.item=t,this.controller=e,this.promise=null}}let vt=class{constructor(t){this._deferreds=new Map,this._controllers=new Map,this._processingItems=new Map,this._isPaused=!1,this._schedule=null,this._task=null,this.concurrency=1,t.concurrency&&(this.concurrency=t.concurrency),this._queue=new V(t.peeker),this.process=t.process;const e=t.scheduler;t.priority&&E(e)&&(this._task=e.registerTask(t.priority,this))}destroy(){this.clear(),this._schedule&&(this._schedule.remove(),this._schedule=null),this._task&&(this._task.remove(),this._task=null)}get length(){return this._processingItems.size+this._queue.length}abort(t){const e=this._controllers.get(t);e&&e.abort()}clear(){this._queue.clear();const t=[];this._controllers.forEach(e=>t.push(e)),this._controllers.clear(),t.forEach(e=>e.abort()),this._processingItems.clear(),this._cancelNext()}forEach(t){this._deferreds.forEach((e,s)=>t(s))}get(t){const e=this._deferreds.get(t);return e?e.promise:void 0}isOngoing(t){return this._processingItems.has(t)}has(t){return this._deferreds.has(t)}pause(){this._isPaused||(this._isPaused=!0,this._cancelNext())}push(t,e){const s=this.get(t);if(s)return s;const r=new AbortController;let n=null;e&&(n=Z(e,()=>r.abort()));const o=()=>{const c=this._processingItems.get(t);c&&c.controller.abort(),l(),a.reject(U())},l=()=>{h.remove(),E(n)&&n.remove(),this._deferreds.delete(t),this._controllers.delete(t),this._queue.remove(t),this._processingItems.delete(t),this._scheduleNext()},h=J(r.signal,o),a=K();return this._deferreds.set(t,a),this._controllers.set(t,r),a.promise.then(l,l),this._queue.push(t),this._scheduleNext(),a.promise}last(){return this._queue.last()}peek(){return this._queue.peek()}popLast(){return this._queue.popLast()}reset(){const t=[];this._processingItems.forEach(e=>t.push(e)),this._processingItems.clear();for(const e of t)this._queue.push(e.item),e.controller.abort();this._scheduleNext()}resume(){this._isPaused&&(this._isPaused=!1,this._scheduleNext())}takeAll(){const t=[];for(;this._queue.length;)t.push(this._queue.pop());return this.clear(),t}get running(){return!this._isPaused&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(t){for(;!t.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),t.madeProgress()}_scheduleNext(){this._task||this._isPaused||this._schedule||(this._schedule=Q(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(t,e){this._canProcessFulfillment(t)&&(this._scheduleNext(),this._deferreds.get(t.item).resolve(e))}_processError(t,e){this._canProcessFulfillment(t)&&(this._scheduleNext(),this._deferreds.get(t.item).reject(e))}_canProcessFulfillment(t){return!!this._deferreds.get(t.item)&&this._processingItems.get(t.item)===t}_process(t){if(G(t))return;let e;const s=new AbortController,r=new ut(t,s);this._processingItems.set(t,r);try{e=this.process(t,s.signal)}catch(n){this._processError(r,n)}H(e)?(r.promise=e,e.then(n=>this._processResult(r,n),n=>this._processError(r,n))):this._processResult(r,e)}get test(){return{update:t=>this.runTask(t)}}},O=class D{constructor(t,e){this.key=new $(0,0,0,0),this.bounds=lt(),this.objectIds=new Set,this.key.set(e);const s=t.getLODInfoAt(this.key);this.tileInfoView=t,this.tileInfoView.getTileBounds(this.bounds,this.key,!0),this.resolution=s.resolution,this.scale=s.scale,this.level=s.level}get id(){return this.key.id}get extent(){return tt.fromBounds(this.bounds,this.tileInfoView.tileInfo.spatialReference)}get transform(){return{originPosition:"upperLeft",scale:[this.resolution,this.resolution],translate:[this.bounds[0],this.bounds[3]]}}createChildTiles(){const t=this.key.getChildKeys(),e=et.acquire();for(let s=0;s<t.length;s++)e[s]=new D(this.tileInfoView,t[s]);return e}getQuantizationParameters(){return st.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})}},z=class{constructor(){this.spans=[]}acquire(t){this.lodInfo=t}release(){this.lodInfo=null,this.spans.length=0}forEach(t,e){const{spans:s,lodInfo:r}=this,{level:n}=r;if(s.length!==0)for(const{row:o,colFrom:l,colTo:h}of s)for(let a=l;a<=h;a++)t.call(e,n,o,r.normalizeCol(a),r.getWorldForColumn(a))}};z.pool=new it(z);const B={added:[],removed:[]},L=new Set,ft=new $(0,0,0,0);let Bt=class extends rt{constructor(t){super(),this._tiles=new Map,this._index=C(9,ot("esri-csp-restrictions")?e=>({minX:e.bounds[0],minY:e.bounds[1],maxX:e.bounds[2],maxY:e.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this.tiles=[],this.tileScheme=t}destroy(){this.clear()}clear(){this.tiles.length=0,this._tiles.clear(),this._index.clear()}has(t){return this._tiles.has(t)}get(t){return this._tiles.get(t)}boundsIntersections(t){return this._index.search({minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]})}updateTiles(t){const e={added:[],removed:[]};for(const s of t.added)if(!this.has(s)){const r=new O(this.tileScheme,s);this._tiles.set(s,r),this._index.insert(r),e.added.push(r)}for(const s of t.removed)if(this.has(s)){const r=this.get(s);this._tiles.delete(s),this._index.remove(r),e.removed.push(r)}this.tiles.length=0,this._tiles.forEach(s=>this.tiles.push(s)),(e.added.length||e.removed.length)&&this.emit("update",e)}setViewState(t){const e=this.tileScheme.getTileCoverage(t,0);if(!e)return;const{spans:s,lodInfo:r}=e,{level:n}=r;if(s.length>0)for(const{row:o,colFrom:l,colTo:h}of s)for(let a=l;a<=h;a++){const c=ft.set(n,o,r.normalizeCol(a),r.getWorldForColumn(a)).id;if(L.add(c),!this.has(c)){const u=new O(this.tileScheme,c);this._tiles.set(c,u),this._index.insert(u),this.tiles.push(u),B.added.push(u)}}for(let o=this.tiles.length-1;o>=0;o--){const l=this.tiles[o];L.has(l.id)||(this._tiles.delete(l.id),this.tiles.splice(o,1),this._index.remove(l),B.removed.push(l))}(B.added.length||B.removed.length)&&this.emit("update",B),z.pool.release(e),L.clear(),B.added.length=0,B.removed.length=0}};function M(i,t){return[i,t]}function y(i,t,e){return i[0]=t,i[1]=e,i}function dt(i,t,e,s,r){return i[0]=t,i[1]=e,i[2]=s,i[3]=r,i}const v=new $("0/0/0/0");class k{static create(t,e,s=null){const r=W(t.spatialReference),n=e.origin||M(t.origin.x,t.origin.y),o=M(t.size[0]*e.resolution,t.size[1]*e.resolution),l=M(-1/0,-1/0),h=M(1/0,1/0),a=M(1/0,1/0);E(s)&&(y(l,Math.max(0,Math.floor((s.xmin-n[0])/o[0])),Math.max(0,Math.floor((n[1]-s.ymax)/o[1]))),y(h,Math.max(0,Math.floor((s.xmax-n[0])/o[0])),Math.max(0,Math.floor((n[1]-s.ymin)/o[1]))),y(a,h[0]-l[0]+1,h[1]-l[1]+1));const{cols:c,rows:u}=e;let _,x,w,m;return!s&&c&&u&&(y(l,c[0],u[0]),y(h,c[1],u[1]),y(a,c[1]-c[0]+1,u[1]-u[0]+1)),t.isWrappable?(_=M(Math.ceil(Math.round((r.valid[1]-r.valid[0])/e.resolution)/t.size[0]),a[1]),x=M(Math.floor((r.origin[0]-n[0])/o[0]),l[1]),w=M(_[0]+x[0]-1,h[1]),m=!0):(x=l,w=h,_=a,m=!1),new k(e.level,e.resolution,e.scale,n,l,h,a,o,x,w,_,m)}constructor(t,e,s,r,n,o,l,h,a,c,u,_){this.level=t,this.resolution=e,this.scale=s,this.origin=r,this.first=n,this.last=o,this.size=l,this.norm=h,this.worldStart=a,this.worldEnd=c,this.worldSize=u,this.wrap=_}normalizeCol(t){if(!this.wrap)return t;const e=this.worldSize[0];return t<0?e-1-Math.abs((t+1)%e):t%e}denormalizeCol(t,e){return this.wrap?this.worldSize[0]*e+t:t}getWorldForColumn(t){return this.wrap?Math.floor(t/this.worldSize[0]):0}getFirstColumnForWorld(t){return t*this.worldSize[0]+this.first[0]}getLastColumnForWorld(t){return t*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(t){return(t-this.origin[0])/this.norm[0]}getXForColumn(t){return this.origin[0]+t*this.norm[0]}getRowForY(t){return(this.origin[1]-t)/this.norm[1]}getYForRow(t){return this.origin[1]-t*this.norm[1]}getTileBounds(t,e,s=!1){v.set(e);const r=s?v.col:this.denormalizeCol(v.col,v.world),n=v.row;return dt(t,this.getXForColumn(r),this.getYForRow(n+1),this.getXForColumn(r+1),this.getYForRow(n)),t}getTileCoords(t,e,s=!1){v.set(e);const r=s?v.col:this.denormalizeCol(v.col,v.world);return Array.isArray(t)?y(t,this.getXForColumn(r),this.getYForRow(v.row)):(t.x=this.getXForColumn(r),t.y=this.getYForRow(v.row)),t}}class q{constructor(t,e,s){this.row=t,this.colFrom=e,this.colTo=s}}const d=new $("0/0/0/0");class P{static create(t,e){t[1]>e[1]&&([t,e]=[e,t]);const[s,r]=t,[n,o]=e,l=n-s,h=o-r,a=h!==0?l/h:0,c=(Math.ceil(r)-r)*a,u=(Math.floor(r)-r)*a;return new P(s,Math.floor(r),Math.ceil(o),a,l<0?c:u,l<0?u:c,l<0?n:s,l<0?s:n)}constructor(t,e,s,r,n,o,l,h){this.x=t,this.ymin=e,this.ymax=s,this.invM=r,this.leftAdjust=n,this.rightAdjust=o,this.leftBound=l,this.rightBound=h}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}}const p=[[0,0],[0,0],[0,0],[0,0]],mt=1e-6;class Xt{constructor(t,e=null){this.tileInfo=t,this.fullExtent=e,this.scales=[],this._infoByScale={},this._infoByLevel={};const s=t.lods.slice();s.sort((n,o)=>o.scale-n.scale);const r=this._lodInfos=s.map(n=>k.create(t,n,e));s.forEach((n,o)=>{this._infoByLevel[n.level]=r[o],this._infoByScale[n.scale]=r[o],this.scales[o]=n.scale},this),this._wrap=t.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(t){return this._infoByLevel[typeof t=="number"?t:t.level]}getTileBounds(t,e,s=!1){d.set(e);const r=this._infoByLevel[d.level];return r?r.getTileBounds(t,d,s):t}getTileCoords(t,e,s=!1){d.set(e);const r=this._infoByLevel[d.level];return r?r.getTileCoords(t,d,s):t}getTileCoverage(t,e=192,s="closest"){const r=s==="closest"?this.getClosestInfoForScale(t.scale):this.getSmallestInfoForScale(t.scale),n=z.pool.acquire(r),o=this._wrap;let l,h,a,c=1/0,u=-1/0;const _=n.spans;p[0][0]=p[0][1]=p[1][1]=p[3][0]=-e,p[1][0]=p[2][0]=t.size[0]+e,p[2][1]=p[3][1]=t.size[1]+e;for(const f of p)t.toMap(f,f),f[0]=r.getColumnForX(f[0]),f[1]=r.getRowForY(f[1]);const x=[];let w=3;for(let f=0;f<4;f++){if(p[f][1]===p[w][1]){w=f;continue}const g=P.create(p[f],p[w]);c=Math.min(g.ymin,c),u=Math.max(g.ymax,u),x[g.ymin]===void 0&&(x[g.ymin]=[]),x[g.ymin].push(g),w=f}if(c==null||u==null||u-c>100)return null;let m=[];for(l=c;l<u;){x[l]!=null&&(m=m.concat(x[l])),h=1/0,a=-1/0;for(let f=m.length-1;f>=0;f--){const g=m[f];h=Math.min(h,g.getLeftCol()),a=Math.max(a,g.getRightCol())}if(h=Math.floor(h),a=Math.floor(a),l>=r.first[1]&&l<=r.last[1])if(o)if(r.size[0]<r.worldSize[0]){const f=Math.floor(a/r.worldSize[0]);for(let g=Math.floor(h/r.worldSize[0]);g<=f;g++)_.push(new q(l,Math.max(r.getFirstColumnForWorld(g),h),Math.min(r.getLastColumnForWorld(g),a)))}else _.push(new q(l,h,a));else h>r.last[0]||a<r.first[0]||(h=Math.max(h,r.first[0]),a=Math.min(a,r.last[0]),_.push(new q(l,h,a)));l+=1;for(let f=m.length-1;f>=0;f--){const g=m[f];g.ymax>=l?g.incrRow():m.splice(f,1)}}return n}getTileParentId(t){d.set(t);const e=this._infoByLevel[d.level],s=this._lodInfos.indexOf(e)-1;return s<0?null:(this._getTileIdAtLOD(d,this._lodInfos[s],d),d.id)}getTileResolution(t){const e=this._infoByLevel[typeof t=="object"?t.level:t];return e?e.resolution:-1}getTileScale(t){const e=this._infoByLevel[t.level];return e?e.scale:-1}intersects(t,e){d.set(e);const s=this._infoByLevel[d.level],r=t.lodInfo;if(r.resolution>s.resolution){this._getTileIdAtLOD(d,r,d);const o=r.denormalizeCol(d.col,d.world);for(const l of t.spans)if(l.row===d.row&&l.colFrom<=o&&l.colTo>=o)return!0}if(r.resolution<s.resolution){const[o,l,h,a]=t.spans.reduce((m,f)=>(m[0]=Math.min(m[0],f.row),m[1]=Math.max(m[1],f.row),m[2]=Math.min(m[2],f.colFrom),m[3]=Math.max(m[3],f.colTo),m),[1/0,-1/0,1/0,-1/0]),c=s.denormalizeCol(d.col,d.world),u=r.getColumnForX(s.getXForColumn(c)),_=r.getRowForY(s.getYForRow(d.row)),x=r.getColumnForX(s.getXForColumn(c+1))-1,w=r.getRowForY(s.getYForRow(d.row+1))-1;return!(u>a||x<h||_>l||w<o)}const n=r.denormalizeCol(d.col,d.world);return t.spans.some(o=>o.row===d.row&&o.colFrom<=n&&o.colTo>=n)}normalizeBounds(t,e,s){if(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],this._wrap){const r=W(this.tileInfo.spatialReference),n=-s*(r.valid[1]-r.valid[0]);t[0]+=n,t[2]+=n}return t}getSmallestInfoForScale(t){const e=this.scales;if(this._infoByScale[t])return this._infoByScale[t];if(t>e[0])return this._infoByScale[e[0]];for(let s=1;s<e.length-1;s++)if(t>e[s]+mt)return this._infoByScale[e[s-1]];return this._infoByScale[e[e.length-1]]}getClosestInfoForScale(t){const e=this.scales;return this._infoByScale[t]||(t=e.reduce((s,r)=>Math.abs(r-t)<Math.abs(s-t)?r:s,e[0])),this._infoByScale[t]}scaleToLevel(t){const e=this.scales;if(this._infoByScale[t])return this._infoByScale[t].level;for(let s=e.length-1;s>=0;s--)if(t<e[s])return s===e.length-1?this._infoByScale[e[e.length-1]].level:this._infoByScale[e[s]].level+(e[s]-t)/(e[s]-e[s+1]);return this._infoByScale[e[0]].level}scaleToZoom(t){return this.tileInfo.scaleToZoom(t)}_getTileIdAtLOD(t,e,s){const r=this._infoByLevel[s.level];return t.set(s),e.resolution<r.resolution?null:(e.resolution===r.resolution||(t.level=e.level,t.col=Math.floor(s.col*r.resolution/e.resolution+.01),t.row=Math.floor(s.row*r.resolution/e.resolution+.01)),t)}}export{z as a,Bt as d,Xt as h,C as i,vt as l};
