import{b7 as z,cu as v,z as P,dh as A}from"./index-1de34779.js";import{n as B}from"./fontUtils-a57700dc.js";import{f as D,y as T,h as R}from"./utils-47432d32.js";import{t as x,e as U,d as $,l as V}from"./symbolUtils-0c3c786b.js";import"./ItemCache-edc397ee.js";import"./utils-960d8c85.js";import"./colorUtils-c0f43caf.js";import"./widget-4447051f.js";import"./uuid-73213768.js";import"./mat2d-e3bbc217.js";import"./webStyleSymbolUtils-1470c8f4.js";import"./devEnvironmentUtils-5002a058.js";function W(a){let{r:e,g:n,b:i,a:l}=a;return l<1&&(e=Math.round(l*e+255*(1-l)),n=Math.round(l*n+255*(1-l)),i=Math.round(l*i+255*(1-l))),new z({r:e,g:n,b:i})}function F(a){const{r:e,g:n,b:i}=W(a);return .2126*e+.7152*n+.0722*i}const Z="picture-fill",H="picture-marker",G="simple-fill",I="simple-line",J="simple-marker",K="text",N="Aa",Q=x.size,k=x.maxSize,X=x.maxOutlineSize,Y=x.lineWidth,j=225,_=document.createElement("canvas");function q(a,e){const n=_.getContext("2d"),i=[];return e&&(e.weight&&i.push(e.weight),e.size&&i.push(e.size+"px"),e.family&&i.push(e.family)),n.font=i.join(" "),n.measureText(a).width}const ee=7.2/2.54,ae=72/2.54;function ne(a){if(a.length===0)return 0;if(a.length>2){const e=A(1),n=parseFloat(a);switch(a.slice(-2)){case"px":return n;case"pt":return n*e;case"in":return 72*n*e;case"pc":return 12*n*e;case"mm":return n*ee*e;case"cm":return n*ae*e}}return parseFloat(a)}function M(a){const e=a==null?void 0:a.size;return{width:e!=null&&typeof e=="object"&&"width"in e?v(e.width):null,height:e!=null&&typeof e=="object"&&"height"in e?v(e.height):null}}async function ie(a,e){const n=e.fill,i=a.color;if((n==null?void 0:n.type)==="pattern"&&i&&a.type!==Z){const l=await R(n.src,i.toCss(!0));n.src=l,e.fill=n}}async function te(a,e,n,i){var p,c,r;if(!("font"in a)||!a.font||e.shape.type!=="text")return;try{await B(a.font)}catch{}const{width:l}=M(i),h=/[\uE600-\uE6FF]/.test(e.shape.text);l!=null||h||(n[0]=q(e.shape.text,{weight:(p=e.font)==null?void 0:p.weight,size:(c=e.font)==null?void 0:c.size,family:(r=e.font)==null?void 0:r.family}))}function E(a,e){return a>e?"dark":"light"}function se(a,e){var L;const n=typeof(e==null?void 0:e.size)=="number"?e==null?void 0:e.size:null,i=n!=null?v(n):null,l=(e==null?void 0:e.maxSize)!=null?v(e.maxSize):null,h=(e==null?void 0:e.rotation)!=null?e.rotation:"angle"in a?a.angle:null,p=D(a);let c=T(a);oe(a,245)!=="dark"||e!=null&&e.ignoreWhiteSymbols||(c={width:.75,...c,color:"#bdc3c7"});const r={shape:null,fill:p,stroke:c,offset:[0,0]};c!=null&&c.width&&(c.width=Math.min(c.width,X));const d=(c==null?void 0:c.width)||0;let g=(e==null?void 0:e.size)!=null&&((e==null?void 0:e.scale)==null||(e==null?void 0:e.scale)),t=0,s=0,b=!1;switch(a.type){case J:{const m=a.style,{width:u,height:o}=M(e),w=u===o&&u!=null?u:i??Math.min(v(a.size),l||k);switch(t=w,s=w,m){case"circle":r.shape={type:"circle",cx:0,cy:0,r:.5*w},g||(t+=d,s+=d);break;case"cross":r.shape={type:"path",path:[{command:"M",values:[0,.5*s]},{command:"L",values:[t,.5*s]},{command:"M",values:[.5*t,0]},{command:"L",values:[.5*t,s]}]};break;case"diamond":r.shape={type:"path",path:[{command:"M",values:[0,.5*s]},{command:"L",values:[.5*t,0]},{command:"L",values:[t,.5*s]},{command:"L",values:[.5*t,s]},{command:"Z",values:[]}]},g||(t+=d,s+=d);break;case"square":r.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[t,0]},{command:"L",values:[t,s]},{command:"L",values:[0,s]},{command:"Z",values:[]}]},g||(t+=d,s+=d),h&&(b=!0);break;case"triangle":r.shape={type:"path",path:[{command:"M",values:[.5*t,0]},{command:"L",values:[t,s]},{command:"L",values:[0,s]},{command:"Z",values:[]}]},g||(t+=d,s+=d),h&&(b=!0);break;case"x":r.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[t,s]},{command:"M",values:[t,0]},{command:"L",values:[0,s]}]},h&&(b=!0);break;case"path":r.shape={type:"path",path:a.path||""},g||(t+=d,s+=d),h&&(b=!0),g=!0}break}case I:{const{width:m,height:u}=M(e),o=u??i??d,w=m??Y;c&&(c.width=o),t=w,s=o;const y=((L=r==null?void 0:r.stroke)==null?void 0:L.cap)||"butt",f=y==="round";g=!0,r.stroke&&(r.stroke.cap=y==="butt"?"square":y),r.shape={type:"path",path:[{command:"M",values:[f?o/2:0,s/2]},{command:"L",values:[f?t-o/2:t,s/2]}]};break}case Z:case G:{const m=typeof(e==null?void 0:e.symbolConfig)=="object"&&(e==null?void 0:e.symbolConfig.isSquareFill),{width:u,height:o}=M(e);t=!m&&u!==o||u==null?i??Q:u,s=!m&&u!==o||o==null?t:o,g||(t+=d,s+=d),g=!0,r.shape=m?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[t,0]},{command:"L",values:[t,s]},{command:"L",values:[0,s]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:U.fill[0];break}case H:{const m=Math.min(v(a.width),l||k),u=Math.min(v(a.height),l||k),{width:o,height:w}=M(e),y=o===w&&o!=null?o:i??Math.max(m,u),f=m/u;t=f<=1?Math.ceil(y*f):y,s=f<=1?y:Math.ceil(y/f),r.shape={type:"image",x:-Math.round(t/2),y:-Math.round(s/2),width:t,height:s,src:a.url||""},h&&(b=!0);break}case K:{const m=a,u=(e==null?void 0:e.overrideText)||m.text||N,o=m.font,{width:w,height:y}=M(e),f=y??i??Math.min(v(o.size),l||k),O=q(u,{weight:o.weight,size:f,family:o.family}),S=/[\uE600-\uE6FF]/.test(u);t=w??(S?f:O),s=f;let C=.25*ne((o?f:0).toString());S&&(C+=5),r.shape={type:"text",text:u,x:m.xoffset||0,y:m.yoffset||C,align:"middle",alignBaseline:m.verticalAlignment,decoration:o&&o.decoration,rotated:m.rotated,kerning:m.kerning},r.font=o&&{size:f,style:o.style,decoration:o.decoration,weight:o.weight,family:o.family};break}}return{shapeDescriptor:r,size:[t,s],renderOptions:{node:e==null?void 0:e.node,scale:g,opacity:e==null?void 0:e.opacity,rotation:h,useRotationSize:b,effectView:e==null?void 0:e.effectView}}}async function ve(a,e){const{shapeDescriptor:n,size:i,renderOptions:l}=se(a,e);if(!n.shape)throw new P("symbolPreview: renderPreviewHTML2D","symbol not supported.");await ie(a,n),await te(a,n,i,e);const h=[[n]];if(typeof(e==null?void 0:e.symbolConfig)=="object"&&(e!=null&&e.symbolConfig.applyColorModulation)){const p=.6*i[0];h.unshift([{...n,offset:[-p,0],fill:$(n.fill,-.3)}]),h.push([{...n,offset:[p,0],fill:$(n.fill,.3)}]),i[0]+=2*p,l.scale=!1}return V(h,i,l)}function oe(a,e=j){const n=D(a),i=T(a),l=!n||"type"in n?null:new z(n),h=i!=null&&i.color?new z(i==null?void 0:i.color):null,p=l?E(F(l),e):null,c=h?E(F(h),e):null;return c?p?p===c?p:e>=j?"light":"dark":c:p}export{oe as getContrastingBackgroundTheme,se as getRenderSymbolParameters,ve as previewSymbol2D};
