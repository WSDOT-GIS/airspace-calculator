import{e as f,y as g,a as zt,ae as ti,Y as ei,t as Me,l as $,h as Y,_ as Ae,j as Ot,a6 as Oi,af as Li,D as Pi,n as ii,q as ni,v as Mi,a3 as $i,ab as xi,C as Ni,as as ki,P as Fi}from"./index-1de34779.js";import{n as _,a as Re,W as oi,e as Ve}from"./widget-4447051f.js";import{t as It}from"./accessibleHandler-c78ecdf0.js";import{e as Ri}from"./vmEvent-d773b6c5.js";import"./uuid-73213768.js";var Te;let ut=Te=class extends ti{constructor(t){super(t),this.displayValueEnabled=!1,this.max=1,this.min=0,this.step=.1,this.type="slider",this.value=null}clone(){return new Te({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,displayValueEnabled:this.displayValueEnabled,max:this.max,min:this.min,step:this.step,value:this.value})}};f([g()],ut.prototype,"displayValueEnabled",void 0),f([g()],ut.prototype,"max",void 0),f([g()],ut.prototype,"min",void 0),f([g()],ut.prototype,"step",void 0),f([g()],ut.prototype,"value",void 0),ut=Te=f([zt("esri.support.Action.ActionSlider")],ut);const Vi=ut,ri={hide:"hide",hideChildren:"hide-children"};function se(t){if(t)return t.listMode!=null?t.listMode:void 0}function Xi(t){if(t)return t.minScale!=null?t.minScale:void 0}function Yi(t){if(t)return t.maxScale!=null?t.maxScale:void 0}function Bi(t){if(!t)return"inherited";const e=t.get("layer.capabilities.exportMap.supportsSublayerVisibility");if(typeof e=="boolean")return e?"independent":"inherited";const i=t.get("capabilities.exportMap.supportsSublayerVisibility");return typeof i=="boolean"?i?"independent":"inherited":t.visibilityMode!=null?t.visibilityMode:"independent"}function si(t){if(t&&(!("type"in t)||t.type!=="wmts")&&t.listMode!==ri.hideChildren)return"sublayers"in t?"sublayers":"layers"in t?"layers":void 0}function Hi(t){const e=t&&(t.get("layer.layer")||t.layer);if(!e)return!1;const i=e.get("capabilities.exportMap.supportsDynamicLayers");return typeof i!="boolean"||i}function Wi(t){return se(t)!==ri.hide}function Ui(t,e){if(!t||isNaN(e))return!1;const i=Xi(t),n=Yi(t),o=!isNaN(i)&&i>0&&e>i,r=!isNaN(n)&&n>0&&e<n;return o||r}function ai(t,e){t&&t.sort((i,n)=>{const o=e.indexOf(i.uid),r=e.indexOf(n.uid);return o>r?-1:o<r?1:0})}function zi(t,e){const i=t==null?void 0:t.layer;if(!i)return;const n=si(i);n&&ai(i.get(n),e)}function Xe(t){const e=t==null?void 0:t.layer;return e&&"layers"in e?e.layers:null}function pe(t,e){var n;const i=(n=t.layer)==null?void 0:n.uid;return i&&e.find(o=>{var r;return((r=o.layer)==null?void 0:r.uid)===i})}function Gi(t){const e=ji(t)?t:null,i=t==null?void 0:t.parent,n=(i==null?void 0:i.type)==="map-image"&&e.source,o="";return n&&i?{layer:i,title:o,sublayerIds:[n.mapLayerId]}:{layer:t,title:o}}function ji(t){return!!(t!=null&&t.layer)}const li="esri-layer-list-panel",Nt=`${li}__content`,rt={base:li,content:Nt,contentLegend:`${Nt}--legend`,contentString:`${Nt}--string`,contentElement:`${Nt}--html-element`,contentWidget:`${Nt}--widget`},qi="legends";let K=class extends ei(oi){constructor(t,e){super(t,e),this._legend=null,this._handles=new Me,this.content=null,this.image=null,this.listItem=null,this.open=!1,this.visible=!0}initialize(){this.addHandles($(()=>this.content,t=>this._createLegend(t),Y))}destroy(){const{_legend:t}=this;t&&t.destroy(),this._legend=null}get className(){const{image:t}=this,e=this._getFirstWidget();return this._get("className")||!t&&e?e.iconClass:""}set className(t){this._override("className",t)}get disabled(){var n;const{listItem:t,_legend:e,content:i}=this;return!t||!(Array.isArray(i)&&i.length>1)&&!!e&&(!((n=e.activeLayerInfos)!=null&&n.length)||!t.visibleAtCurrentScale)}set disabled(t){this._overrideIfSome("disabled",t)}get title(){const t=this._getFirstWidget();return this._get("title")||t?t.label:""}set title(t){this._override("title",t)}render(){return _("div",{class:rt.base},this._renderContents())}_renderContent(t){const{_legend:e,disabled:i}=this;return!t||i?null:t==="legend"&&e?_("div",{class:this.classes(rt.content,rt.contentLegend),key:e},e.render()):typeof t=="string"?_("div",{class:this.classes(rt.content,rt.contentString),key:t,innerHTML:t}):Re(t)?_("div",{class:this.classes(rt.content,rt.contentWidget),key:t},t.render()):t instanceof HTMLElement?_("div",{class:this.classes(rt.content,rt.contentElement),key:t,bind:t,afterCreate:this._attachToNode}):null}_renderContents(){const{content:t}=this;return Array.isArray(t)?t.map(e=>this._renderContent(e)):this._renderContent(t)}_getLegendOptions(){const{listItem:t}=this;if(!t)return{};const{layer:e,view:i}=t;return e&&i?{view:i,layerInfos:[Gi(e)]}:{}}_createLegend(t){this._hasLegend(t)&&!this._legend&&Ae(()=>import("./Legend-e3b03dd5.js"),["assets/Legend-e3b03dd5.js","assets/index-1de34779.js","assets/index-252dcfb5.css","assets/widget-4447051f.js","assets/uuid-73213768.js","assets/EffectView-8576c2a4.js","assets/ExportImageParameters-8641ce6e.js","assets/floorFilterUtils-080a7cd2.js","assets/sublayerUtils-6f5364f7.js","assets/pixelRangeUtils-03719dd8.js","assets/utils-47432d32.js","assets/ItemCache-edc397ee.js","assets/utils-960d8c85.js","assets/symbolUtils-0c3c786b.js","assets/colorUtils-c0f43caf.js","assets/mat2d-e3bbc217.js","assets/webStyleSymbolUtils-1470c8f4.js","assets/devEnvironmentUtils-5002a058.js","assets/Heading-bde04247.js","assets/accessibleHandler-c78ecdf0.js"]).then(({default:e})=>{const{_handles:i,listItem:n}=this,o=new e(this._getLegendOptions());this._legend=o,this.notifyChange("className"),this.notifyChange("title");const r=$(()=>{var s,a;return[n==null?void 0:n.view,n==null?void 0:n.layer,(s=n==null?void 0:n.layer)==null?void 0:s.source,(a=n==null?void 0:n.layer)==null?void 0:a.parent]},()=>this._updateLegend(o),Y);i.add(r,qi),this.scheduleRender()})}_hasLegend(t){const e="legend";return t===e||!!Array.isArray(t)&&t.includes(e)}_attachToNode(t){t.appendChild(this)}_updateLegend(t){t.set(this._getLegendOptions()),this.scheduleRender()}_getWidget(t){return t==="legend"?this._legend:Re(t)?t:null}_getFirstWidget(){const{content:t}=this;if(Array.isArray(t)){let e=null;return t.some(i=>{const n=this._getWidget(i);return n&&(e=n),!!n}),e}return this._getWidget(t)}};f([g()],K.prototype,"_legend",void 0),f([g()],K.prototype,"className",null),f([g()],K.prototype,"content",void 0),f([g()],K.prototype,"disabled",null),f([g()],K.prototype,"image",void 0),f([g()],K.prototype,"listItem",void 0),f([g()],K.prototype,"title",null),f([g()],K.prototype,"open",void 0),f([g()],K.prototype,"visible",void 0),K=f([zt("esri.widgets.LayerList.ListItemPanel")],K);const di=K;var Ft;const Ki=Ot.ofType({key:"type",defaultKeyValue:"button",base:ti,typeMap:{button:Oi,toggle:Li,slider:Vi}}),ci=Ot.ofType(Ki),Kt="layer",fe="child-list-mode",Zi="hide",Qi="esri.widgets.LayerList.ListItem";let A=Ft=class extends ei(Pi(Mi)){constructor(t){super(t),this.actionsSections=new ci,this.actionsOpen=!1,this.checkPublishStatusEnabled=!1,this.children=new(Ot.ofType(Ft)),this.childrenSortable=!0,this.hidden=!1,this.layer=null,this.layerView=null,this.listItemCreatedFunction=null,this.open=!1,this.panel=null,this.parent=null,this.sortable=!0,this.view=null}initialize(){if(this.handles.add([$(()=>this.layer,t=>this._watchLayerProperties(t),Y),$(()=>this.checkPublishStatusEnabled,t=>this._updateChildrenPublishing(t),Y),$(()=>this.view,t=>this._updateChildrenView(t),Y),$(()=>this.panel,t=>this._setListItemOnPanel(t),Y),$(()=>[this.layer,this.view],()=>this._getLayerView(),Y)]),typeof this.listItemCreatedFunction=="function"){const t={item:this};this.listItemCreatedFunction.call(null,t)}}destroy(){this.view=null}get connectionStatus(){const{layerView:t,publishing:e}=this;if(!e&&t&&"connectionStatus"in t)return t.connectionStatus}get error(){var t;return(t=this.layer)==null?void 0:t.loadError}get incompatible(){const{layerView:t}=this;return!(!t||!("spatialReferenceSupported"in t))&&!t.spatialReferenceSupported}castPanel(t){return this.get("panel.open")&&!t.hasOwnProperty("open")&&(t.open=!0),t?new di(t):null}get title(){const t=this.get("layer.layer");return(!t||t&&this.get("layer.layer.loaded"))&&this.get("layer.title")||this.get("layer.attributes.title")||""}set title(t){this._override("title",t)}get publishing(){var i;const{layer:t,checkPublishStatusEnabled:e}=this;return e&&t&&"publishingInfo"in t&&((i=t.publishingInfo)==null?void 0:i.status)==="publishing"}get updating(){const{layerView:t,connectionStatus:e,layer:i,publishing:n}=this;return!n&&!e&&(t?t.updating:(i==null?void 0:i.loadStatus)==="loading"||!1)}get visible(){var t;return(t=this.layer)==null?void 0:t.visible}set visible(t){const e=this.layer;e&&(e.visible=t)}get visibleAtCurrentScale(){return!Ui(this.layer,this.get("view.scale"))}get visibilityMode(){return Bi(this.layer)}clone(){return new Ft({actionsSections:this.actionsSections.clone(),actionsOpen:this.actionsOpen,checkPublishStatusEnabled:this.checkPublishStatusEnabled,children:this.children.clone(),layer:this.layer,listItemCreatedFunction:this.listItemCreatedFunction,open:this.open,panel:this.panel,title:this.title,view:this.view,visible:this.visible})}_setListItemOnPanel(t){t&&(t.listItem=this)}_updateChildrenPublishing(t){const e=this.children;e&&e.forEach(i=>i.checkPublishStatusEnabled=t)}_updateChildrenView(t){const e=this.children;e&&e.forEach(i=>i.view=t)}_addChildren(t){if(this.handles.remove(fe),this.children.removeAll(),!t)return;t.forEach(i=>{this.handles.add($(()=>i.listMode,()=>this._addChildren(t)),fe)});const e=t.filter(i=>se(i)!==Zi);this.children.addMany(this._makeChildren(e))}_watchSublayerChanges(t){t&&this.handles.add(t.on("change",()=>{this._addChildren(t)}),Kt)}_initializeChildLayers(t){this._addChildren(t),this._watchSublayerChanges(t)}_makeChildren(t){return t.map(e=>Wi(e)?new Ft({layer:e,checkPublishStatusEnabled:this.checkPublishStatusEnabled,listItemCreatedFunction:this.listItemCreatedFunction,parent:this,view:this.view}):null).filter(ii).reverse()}_watchLayerProperties(t){if(!this.handles||(this.handles.remove(Kt),this.handles.remove(fe),!t))return;if(this.handles.add($(()=>t.listMode,()=>this._watchLayerProperties(t)),Kt),se(t)==="hide-children")return void this.children.removeAll();const e=si(t);e&&this.handles.add($(()=>t[e],()=>{t.hasOwnProperty(e)&&this._initializeChildLayers(t[e])},Y),Kt)}async _getLayerView(){const{layer:t,view:e}=this;if(t&&e)try{const i=await e.whenLayerView(t);if(i.layer!==this.layer)return;this._set("layerView",i)}catch{}}};f([g({type:ci})],A.prototype,"actionsSections",void 0),f([g()],A.prototype,"actionsOpen",void 0),f([g()],A.prototype,"checkPublishStatusEnabled",void 0),f([g({type:Ot})],A.prototype,"children",void 0),f([g()],A.prototype,"childrenSortable",void 0),f([g({readOnly:!0})],A.prototype,"connectionStatus",null),f([g({readOnly:!0})],A.prototype,"error",null),f([g()],A.prototype,"hidden",void 0),f([g({readOnly:!0})],A.prototype,"incompatible",null),f([g()],A.prototype,"layer",void 0),f([g({readOnly:!0})],A.prototype,"layerView",void 0),f([g()],A.prototype,"listItemCreatedFunction",void 0),f([g()],A.prototype,"open",void 0),f([g({type:di})],A.prototype,"panel",void 0),f([ni("panel")],A.prototype,"castPanel",null),f([g()],A.prototype,"parent",void 0),f([g()],A.prototype,"sortable",void 0),f([g()],A.prototype,"title",null),f([g({readOnly:!0})],A.prototype,"publishing",null),f([g({readOnly:!0})],A.prototype,"updating",null),f([g()],A.prototype,"view",void 0),f([g()],A.prototype,"visible",null),f([g({readOnly:!0})],A.prototype,"visibleAtCurrentScale",null),f([g({readOnly:!0})],A.prototype,"visibilityMode",null),A=Ft=f([zt(Qi)],A);const $e=A,z={view:"view",viewLayers:"view-layers",mapLayers:"map-layers",layerViews:"layer-views",layerListMode:"layer-list-mode",children:"children"},Ji="hide",ui=Ot.ofType($e);let ht=class extends $i.EventedAccessor{constructor(t){super(t),this._handles=new Me,this.checkPublishStatusEnabled=!1,this.listItemCreatedFunction=null,this.operationalItems=new ui,this.view=null}initialize(){this._handles.add([$(()=>{var t;return[this.view,(t=this.view)==null?void 0:t.ready]},()=>this._viewHandles(),Y),$(()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled],()=>this._recompileList())],z.view)}destroy(){this._handles.destroy(),this._handles=null,this.view=null,this.operationalItems.removeAll()}get state(){const t=this.get("view");return this.get("view.ready")?"ready":t?"loading":"disabled"}triggerAction(t,e){t&&!t.disabled&&this.emit("trigger-action",{action:t,item:e})}moveListItem(t,e,i,n){var b,I;const o=t==null?void 0:t.layer;if(!o)return;const r=(I=(b=this.view)==null?void 0:b.map)==null?void 0:I.layers,s=e?Xe(e):r,a=i?Xe(i):r;if(!s||!a)return;const{operationalItems:l}=this,d=(e==null?void 0:e.children)||l,h=(i==null?void 0:i.children)||l,p=a.length-n;t.parent=i||null,d.includes(t)&&d.remove(t),s.includes(o)&&s.remove(o),h.includes(t)||h.add(t,p),a.includes(o)||a.add(o,p)}_createLayerViewHandles(t){const{_handles:e}=this;e.remove(z.layerViews),this._compileList(),t&&e.add(t.on("change",()=>this._compileList()),z.layerViews)}_createMapLayerHandles(t){const{_handles:e}=this;e.remove(z.mapLayers),this._compileList(),t&&e.add(t.on("change",()=>this._compileList()),z.mapLayers)}_createListItem(t){const{view:e,listItemCreatedFunction:i,checkPublishStatusEnabled:n}=this;return new $e({checkPublishStatusEnabled:n,layer:t,listItemCreatedFunction:i,view:e})}_removeAllItems(){const{_handles:t,operationalItems:e}=this;e.forEach(i=>{t.remove(`${z.children}-${i.uid}`)}),e.removeAll()}_getViewableLayers(t){if(t)return t.filter(e=>se(e)!==Ji)}_watchLayersListMode(t){const{_handles:e}=this;e.remove(z.layerListMode),t&&t.forEach(i=>{"listMode"in i&&e.add($(()=>i.listMode,()=>this._compileList()),z.layerListMode)})}_compileList(){const t=this.get("view.map.layers");this._watchLayersListMode(t);const e=this._getViewableLayers(t);e&&e.length?(this._createNewItems(e),this._removeItems(e),this._sortItems(e)):this._removeAllItems()}_createNewItems(t){const{operationalItems:e}=this;t.forEach(i=>{e.find(n=>n.layer===i)||e.add(this._createListItem(i))})}_removeItems(t){const{_handles:e,operationalItems:i}=this,n=[];i.forEach(o=>{o&&t&&t.includes(o.layer)||(e.remove(`${z.children}-${o.uid}`),n.push(o))}),i.removeMany(n)}_sortItems(t){const{operationalItems:e}=this;e.sort((i,n)=>{const o=t.indexOf(i.layer),r=t.indexOf(n.layer);return o>r?-1:o<r?1:0})}_recompileList(){this._removeAllItems(),this._compileList()}_viewHandles(){const{_handles:t,view:e}=this;t.remove([z.mapLayers,z.layerViews,z.viewLayers]),this._compileList(),e&&e.ready&&t.add([$(()=>{var i,n;return(n=(i=this.view)==null?void 0:i.map)==null?void 0:n.allLayers},i=>this._createMapLayerHandles(i),Y),$(()=>{var i;return(i=this.view)==null?void 0:i.allLayerViews},i=>this._createLayerViewHandles(i),Y)],z.viewLayers)}};f([g()],ht.prototype,"checkPublishStatusEnabled",void 0),f([g()],ht.prototype,"listItemCreatedFunction",void 0),f([g({type:ui})],ht.prototype,"operationalItems",void 0),f([g({readOnly:!0})],ht.prototype,"state",null),f([g()],ht.prototype,"view",void 0),ht=f([zt("esri.widgets.LayerList.LayerListViewModel")],ht);const hi=ht;/**!
 * Sortable 1.15.0
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function Ye(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),i.push.apply(i,n)}return i}function nt(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?Ye(Object(i),!0).forEach(function(n){tn(t,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Ye(Object(i)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(i,n))})}return t}function ee(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ee=function(e){return typeof e}:ee=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ee(t)}function tn(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function at(){return at=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},at.apply(this,arguments)}function en(t,e){if(t==null)return{};var i={},n=Object.keys(t),o,r;for(r=0;r<n.length;r++)o=n[r],!(e.indexOf(o)>=0)&&(i[o]=t[o]);return i}function nn(t,e){if(t==null)return{};var i=en(t,e),n,o;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(o=0;o<r.length;o++)n=r[o],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}var on="1.15.0";function st(t){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(t)}var lt=st(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Gt=st(/Edge/i),Be=st(/firefox/i),Yt=st(/safari/i)&&!st(/chrome/i)&&!st(/android/i),pi=st(/iP(ad|od|hone)/i),fi=st(/chrome/i)&&st(/android/i),gi={capture:!1,passive:!1};function C(t,e,i){t.addEventListener(e,i,!lt&&gi)}function E(t,e,i){t.removeEventListener(e,i,!lt&&gi)}function ae(t,e){if(e){if(e[0]===">"&&(e=e.substring(1)),t)try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch{return!1}return!1}}function rn(t){return t.host&&t!==document&&t.host.nodeType?t.host:t.parentNode}function et(t,e,i,n){if(t){i=i||document;do{if(e!=null&&(e[0]===">"?t.parentNode===i&&ae(t,e):ae(t,e))||n&&t===i)return t;if(t===i)break}while(t=rn(t))}return null}var He=/\s+/g;function G(t,e,i){if(t&&e)if(t.classList)t.classList[i?"add":"remove"](e);else{var n=(" "+t.className+" ").replace(He," ").replace(" "+e+" "," ");t.className=(n+(i?" "+e:"")).replace(He," ")}}function m(t,e,i){var n=t&&t.style;if(n){if(i===void 0)return document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(i=t.currentStyle),e===void 0?i:i[e];!(e in n)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),n[e]=i+(typeof i=="string"?"":"px")}}function Tt(t,e){var i="";if(typeof t=="string")i=t;else do{var n=m(t,"transform");n&&n!=="none"&&(i=n+" "+i)}while(!e&&(t=t.parentNode));var o=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return o&&new o(i)}function mi(t,e,i){if(t){var n=t.getElementsByTagName(e),o=0,r=n.length;if(i)for(;o<r;o++)i(n[o],o);return n}return[]}function it(){var t=document.scrollingElement;return t||document.documentElement}function N(t,e,i,n,o){if(!(!t.getBoundingClientRect&&t!==window)){var r,s,a,l,d,h,p;if(t!==window&&t.parentNode&&t!==it()?(r=t.getBoundingClientRect(),s=r.top,a=r.left,l=r.bottom,d=r.right,h=r.height,p=r.width):(s=0,a=0,l=window.innerHeight,d=window.innerWidth,h=window.innerHeight,p=window.innerWidth),(e||i)&&t!==window&&(o=o||t.parentNode,!lt))do if(o&&o.getBoundingClientRect&&(m(o,"transform")!=="none"||i&&m(o,"position")!=="static")){var b=o.getBoundingClientRect();s-=b.top+parseInt(m(o,"border-top-width")),a-=b.left+parseInt(m(o,"border-left-width")),l=s+r.height,d=a+r.width;break}while(o=o.parentNode);if(n&&t!==window){var I=Tt(o||t),w=I&&I.a,S=I&&I.d;I&&(s/=S,a/=w,p/=w,h/=S,l=s+h,d=a+p)}return{top:s,left:a,bottom:l,right:d,width:p,height:h}}}function We(t,e,i){for(var n=gt(t,!0),o=N(t)[e];n;){var r=N(n)[i],s=void 0;if(i==="top"||i==="left"?s=o>=r:s=o<=r,!s)return n;if(n===it())break;n=gt(n,!1)}return!1}function Dt(t,e,i,n){for(var o=0,r=0,s=t.children;r<s.length;){if(s[r].style.display!=="none"&&s[r]!==v.ghost&&(n||s[r]!==v.dragged)&&et(s[r],i.draggable,t,!1)){if(o===e)return s[r];o++}r++}return null}function xe(t,e){for(var i=t.lastElementChild;i&&(i===v.ghost||m(i,"display")==="none"||e&&!ae(i,e));)i=i.previousElementSibling;return i||null}function Z(t,e){var i=0;if(!t||!t.parentNode)return-1;for(;t=t.previousElementSibling;)t.nodeName.toUpperCase()!=="TEMPLATE"&&t!==v.clone&&(!e||ae(t,e))&&i++;return i}function Ue(t){var e=0,i=0,n=it();if(t)do{var o=Tt(t),r=o.a,s=o.d;e+=t.scrollLeft*r,i+=t.scrollTop*s}while(t!==n&&(t=t.parentNode));return[e,i]}function sn(t,e){for(var i in t)if(t.hasOwnProperty(i)){for(var n in e)if(e.hasOwnProperty(n)&&e[n]===t[i][n])return Number(i)}return-1}function gt(t,e){if(!t||!t.getBoundingClientRect)return it();var i=t,n=!1;do if(i.clientWidth<i.scrollWidth||i.clientHeight<i.scrollHeight){var o=m(i);if(i.clientWidth<i.scrollWidth&&(o.overflowX=="auto"||o.overflowX=="scroll")||i.clientHeight<i.scrollHeight&&(o.overflowY=="auto"||o.overflowY=="scroll")){if(!i.getBoundingClientRect||i===document.body)return it();if(n||e)return i;n=!0}}while(i=i.parentNode);return it()}function an(t,e){if(t&&e)for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}function ge(t,e){return Math.round(t.top)===Math.round(e.top)&&Math.round(t.left)===Math.round(e.left)&&Math.round(t.height)===Math.round(e.height)&&Math.round(t.width)===Math.round(e.width)}var Bt;function vi(t,e){return function(){if(!Bt){var i=arguments,n=this;i.length===1?t.call(n,i[0]):t.apply(n,i),Bt=setTimeout(function(){Bt=void 0},e)}}}function ln(){clearTimeout(Bt),Bt=void 0}function bi(t,e,i){t.scrollLeft+=e,t.scrollTop+=i}function yi(t){var e=window.Polymer,i=window.jQuery||window.Zepto;return e&&e.dom?e.dom(t).cloneNode(!0):i?i(t).clone(!0)[0]:t.cloneNode(!0)}var q="Sortable"+new Date().getTime();function dn(){var t=[],e;return{captureAnimationState:function(){if(t=[],!!this.options.animation){var n=[].slice.call(this.el.children);n.forEach(function(o){if(!(m(o,"display")==="none"||o===v.ghost)){t.push({target:o,rect:N(o)});var r=nt({},t[t.length-1].rect);if(o.thisAnimationDuration){var s=Tt(o,!0);s&&(r.top-=s.f,r.left-=s.e)}o.fromRect=r}})}},addAnimationState:function(n){t.push(n)},removeAnimationState:function(n){t.splice(sn(t,{target:n}),1)},animateAll:function(n){var o=this;if(!this.options.animation){clearTimeout(e),typeof n=="function"&&n();return}var r=!1,s=0;t.forEach(function(a){var l=0,d=a.target,h=d.fromRect,p=N(d),b=d.prevFromRect,I=d.prevToRect,w=a.rect,S=Tt(d,!0);S&&(p.top-=S.f,p.left-=S.e),d.toRect=p,d.thisAnimationDuration&&ge(b,p)&&!ge(h,p)&&(w.top-p.top)/(w.left-p.left)===(h.top-p.top)/(h.left-p.left)&&(l=un(w,b,I,o.options)),ge(p,h)||(d.prevFromRect=h,d.prevToRect=p,l||(l=o.options.animation),o.animate(d,w,p,l)),l&&(r=!0,s=Math.max(s,l),clearTimeout(d.animationResetTimer),d.animationResetTimer=setTimeout(function(){d.animationTime=0,d.prevFromRect=null,d.fromRect=null,d.prevToRect=null,d.thisAnimationDuration=null},l),d.thisAnimationDuration=l)}),clearTimeout(e),r?e=setTimeout(function(){typeof n=="function"&&n()},s):typeof n=="function"&&n(),t=[]},animate:function(n,o,r,s){if(s){m(n,"transition",""),m(n,"transform","");var a=Tt(this.el),l=a&&a.a,d=a&&a.d,h=(o.left-r.left)/(l||1),p=(o.top-r.top)/(d||1);n.animatingX=!!h,n.animatingY=!!p,m(n,"transform","translate3d("+h+"px,"+p+"px,0)"),this.forRepaintDummy=cn(n),m(n,"transition","transform "+s+"ms"+(this.options.easing?" "+this.options.easing:"")),m(n,"transform","translate3d(0,0,0)"),typeof n.animated=="number"&&clearTimeout(n.animated),n.animated=setTimeout(function(){m(n,"transition",""),m(n,"transform",""),n.animated=!1,n.animatingX=!1,n.animatingY=!1},s)}}}}function cn(t){return t.offsetWidth}function un(t,e,i,n){return Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))/Math.sqrt(Math.pow(e.top-i.top,2)+Math.pow(e.left-i.left,2))*n.animation}var Et=[],me={initializeByDefault:!0},jt={mount:function(e){for(var i in me)me.hasOwnProperty(i)&&!(i in e)&&(e[i]=me[i]);Et.forEach(function(n){if(n.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),Et.push(e)},pluginEvent:function(e,i,n){var o=this;this.eventCanceled=!1,n.cancel=function(){o.eventCanceled=!0};var r=e+"Global";Et.forEach(function(s){i[s.pluginName]&&(i[s.pluginName][r]&&i[s.pluginName][r](nt({sortable:i},n)),i.options[s.pluginName]&&i[s.pluginName][e]&&i[s.pluginName][e](nt({sortable:i},n)))})},initializePlugins:function(e,i,n,o){Et.forEach(function(a){var l=a.pluginName;if(!(!e.options[l]&&!a.initializeByDefault)){var d=new a(e,i,e.options);d.sortable=e,d.options=e.options,e[l]=d,at(n,d.defaults)}});for(var r in e.options)if(e.options.hasOwnProperty(r)){var s=this.modifyOption(e,r,e.options[r]);typeof s<"u"&&(e.options[r]=s)}},getEventProperties:function(e,i){var n={};return Et.forEach(function(o){typeof o.eventProperties=="function"&&at(n,o.eventProperties.call(i[o.pluginName],e))}),n},modifyOption:function(e,i,n){var o;return Et.forEach(function(r){e[r.pluginName]&&r.optionListeners&&typeof r.optionListeners[i]=="function"&&(o=r.optionListeners[i].call(e[r.pluginName],n))}),o}};function hn(t){var e=t.sortable,i=t.rootEl,n=t.name,o=t.targetEl,r=t.cloneEl,s=t.toEl,a=t.fromEl,l=t.oldIndex,d=t.newIndex,h=t.oldDraggableIndex,p=t.newDraggableIndex,b=t.originalEvent,I=t.putSortable,w=t.extraEventProperties;if(e=e||i&&i[q],!!e){var S,B=e.options,R="on"+n.charAt(0).toUpperCase()+n.substr(1);window.CustomEvent&&!lt&&!Gt?S=new CustomEvent(n,{bubbles:!0,cancelable:!0}):(S=document.createEvent("Event"),S.initEvent(n,!0,!0)),S.to=s||i,S.from=a||i,S.item=o||i,S.clone=r,S.oldIndex=l,S.newIndex=d,S.oldDraggableIndex=h,S.newDraggableIndex=p,S.originalEvent=b,S.pullMode=I?I.lastPutMode:void 0;var V=nt(nt({},w),jt.getEventProperties(n,e));for(var Q in V)S[Q]=V[Q];i&&i.dispatchEvent(S),B[R]&&B[R].call(e,S)}}var pn=["evt"],H=function(e,i){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=n.evt,r=nn(n,pn);jt.pluginEvent.bind(v)(e,i,nt({dragEl:c,parentEl:P,ghostEl:y,rootEl:O,nextEl:wt,lastDownEl:ie,cloneEl:L,cloneHidden:ft,dragStarted:Rt,putSortable:k,activeSortable:v.active,originalEvent:o,oldIndex:At,oldDraggableIndex:Ht,newIndex:j,newDraggableIndex:pt,hideGhostForTarget:Ei,unhideGhostForTarget:Si,cloneNowHidden:function(){ft=!0},cloneNowShown:function(){ft=!1},dispatchSortableEvent:function(a){X({sortable:i,name:a,originalEvent:o})}},r))};function X(t){hn(nt({putSortable:k,cloneEl:L,targetEl:c,rootEl:O,oldIndex:At,oldDraggableIndex:Ht,newIndex:j,newDraggableIndex:pt},t))}var c,P,y,O,wt,ie,L,ft,At,j,Ht,pt,Zt,k,Ct=!1,le=!1,de=[],yt,J,ve,be,ze,Ge,Rt,St,Wt,Ut=!1,Qt=!1,ne,F,ye=[],De=!1,ce=[],he=typeof document<"u",Jt=pi,je=Gt||lt?"cssFloat":"float",fn=he&&!fi&&!pi&&"draggable"in document.createElement("div"),_i=function(){if(he){if(lt)return!1;var t=document.createElement("x");return t.style.cssText="pointer-events:auto",t.style.pointerEvents==="auto"}}(),wi=function(e,i){var n=m(e),o=parseInt(n.width)-parseInt(n.paddingLeft)-parseInt(n.paddingRight)-parseInt(n.borderLeftWidth)-parseInt(n.borderRightWidth),r=Dt(e,0,i),s=Dt(e,1,i),a=r&&m(r),l=s&&m(s),d=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+N(r).width,h=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+N(s).width;if(n.display==="flex")return n.flexDirection==="column"||n.flexDirection==="column-reverse"?"vertical":"horizontal";if(n.display==="grid")return n.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(r&&a.float&&a.float!=="none"){var p=a.float==="left"?"left":"right";return s&&(l.clear==="both"||l.clear===p)?"vertical":"horizontal"}return r&&(a.display==="block"||a.display==="flex"||a.display==="table"||a.display==="grid"||d>=o&&n[je]==="none"||s&&n[je]==="none"&&d+h>o)?"vertical":"horizontal"},gn=function(e,i,n){var o=n?e.left:e.top,r=n?e.right:e.bottom,s=n?e.width:e.height,a=n?i.left:i.top,l=n?i.right:i.bottom,d=n?i.width:i.height;return o===a||r===l||o+s/2===a+d/2},mn=function(e,i){var n;return de.some(function(o){var r=o[q].options.emptyInsertThreshold;if(!(!r||xe(o))){var s=N(o),a=e>=s.left-r&&e<=s.right+r,l=i>=s.top-r&&i<=s.bottom+r;if(a&&l)return n=o}}),n},Ii=function(e){function i(r,s){return function(a,l,d,h){var p=a.options.group.name&&l.options.group.name&&a.options.group.name===l.options.group.name;if(r==null&&(s||p))return!0;if(r==null||r===!1)return!1;if(s&&r==="clone")return r;if(typeof r=="function")return i(r(a,l,d,h),s)(a,l,d,h);var b=(s?a:l).options.group.name;return r===!0||typeof r=="string"&&r===b||r.join&&r.indexOf(b)>-1}}var n={},o=e.group;(!o||ee(o)!="object")&&(o={name:o}),n.name=o.name,n.checkPull=i(o.pull,!0),n.checkPut=i(o.put),n.revertClone=o.revertClone,e.group=n},Ei=function(){!_i&&y&&m(y,"display","none")},Si=function(){!_i&&y&&m(y,"display","")};he&&!fi&&document.addEventListener("click",function(t){if(le)return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),le=!1,!1},!0);var _t=function(e){if(c){e=e.touches?e.touches[0]:e;var i=mn(e.clientX,e.clientY);if(i){var n={};for(var o in e)e.hasOwnProperty(o)&&(n[o]=e[o]);n.target=n.rootEl=i,n.preventDefault=void 0,n.stopPropagation=void 0,i[q]._onDragOver(n)}}},vn=function(e){c&&c.parentNode[q]._isOutsideThisEl(e.target)};function v(t,e){if(!(t&&t.nodeType&&t.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.el=t,this.options=e=at({},e),t[q]=this;var i={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(t.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return wi(t,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(s,a){s.setData("Text",a.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:v.supportPointer!==!1&&"PointerEvent"in window&&!Yt,emptyInsertThreshold:5};jt.initializePlugins(this,t,i);for(var n in i)!(n in e)&&(e[n]=i[n]);Ii(e);for(var o in this)o.charAt(0)==="_"&&typeof this[o]=="function"&&(this[o]=this[o].bind(this));this.nativeDraggable=e.forceFallback?!1:fn,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?C(t,"pointerdown",this._onTapStart):(C(t,"mousedown",this._onTapStart),C(t,"touchstart",this._onTapStart)),this.nativeDraggable&&(C(t,"dragover",this),C(t,"dragenter",this)),de.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),at(this,dn())}v.prototype={constructor:v,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(St=null)},_getDirection:function(e,i){return typeof this.options.direction=="function"?this.options.direction.call(this,e,i,c):this.options.direction},_onTapStart:function(e){if(e.cancelable){var i=this,n=this.el,o=this.options,r=o.preventOnFilter,s=e.type,a=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,l=(a||e).target,d=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||l,h=o.filter;if(Cn(n),!c&&!(/mousedown|pointerdown/.test(s)&&e.button!==0||o.disabled)&&!d.isContentEditable&&!(!this.nativeDraggable&&Yt&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=et(l,o.draggable,n,!1),!(l&&l.animated)&&ie!==l)){if(At=Z(l),Ht=Z(l,o.draggable),typeof h=="function"){if(h.call(this,e,l,this)){X({sortable:i,rootEl:d,name:"filter",targetEl:l,toEl:n,fromEl:n}),H("filter",i,{evt:e}),r&&e.cancelable&&e.preventDefault();return}}else if(h&&(h=h.split(",").some(function(p){if(p=et(d,p.trim(),n,!1),p)return X({sortable:i,rootEl:p,name:"filter",targetEl:l,fromEl:n,toEl:n}),H("filter",i,{evt:e}),!0}),h)){r&&e.cancelable&&e.preventDefault();return}o.handle&&!et(d,o.handle,n,!1)||this._prepareDragStart(e,a,l)}}},_prepareDragStart:function(e,i,n){var o=this,r=o.el,s=o.options,a=r.ownerDocument,l;if(n&&!c&&n.parentNode===r){var d=N(n);if(O=r,c=n,P=c.parentNode,wt=c.nextSibling,ie=n,Zt=s.group,v.dragged=c,yt={target:c,clientX:(i||e).clientX,clientY:(i||e).clientY},ze=yt.clientX-d.left,Ge=yt.clientY-d.top,this._lastX=(i||e).clientX,this._lastY=(i||e).clientY,c.style["will-change"]="all",l=function(){if(H("delayEnded",o,{evt:e}),v.eventCanceled){o._onDrop();return}o._disableDelayedDragEvents(),!Be&&o.nativeDraggable&&(c.draggable=!0),o._triggerDragStart(e,i),X({sortable:o,name:"choose",originalEvent:e}),G(c,s.chosenClass,!0)},s.ignore.split(",").forEach(function(h){mi(c,h.trim(),_e)}),C(a,"dragover",_t),C(a,"mousemove",_t),C(a,"touchmove",_t),C(a,"mouseup",o._onDrop),C(a,"touchend",o._onDrop),C(a,"touchcancel",o._onDrop),Be&&this.nativeDraggable&&(this.options.touchStartThreshold=4,c.draggable=!0),H("delayStart",this,{evt:e}),s.delay&&(!s.delayOnTouchOnly||i)&&(!this.nativeDraggable||!(Gt||lt))){if(v.eventCanceled){this._onDrop();return}C(a,"mouseup",o._disableDelayedDrag),C(a,"touchend",o._disableDelayedDrag),C(a,"touchcancel",o._disableDelayedDrag),C(a,"mousemove",o._delayedDragTouchMoveHandler),C(a,"touchmove",o._delayedDragTouchMoveHandler),s.supportPointer&&C(a,"pointermove",o._delayedDragTouchMoveHandler),o._dragStartTimer=setTimeout(l,s.delay)}else l()}},_delayedDragTouchMoveHandler:function(e){var i=e.touches?e.touches[0]:e;Math.max(Math.abs(i.clientX-this._lastX),Math.abs(i.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){c&&_e(c),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;E(e,"mouseup",this._disableDelayedDrag),E(e,"touchend",this._disableDelayedDrag),E(e,"touchcancel",this._disableDelayedDrag),E(e,"mousemove",this._delayedDragTouchMoveHandler),E(e,"touchmove",this._delayedDragTouchMoveHandler),E(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,i){i=i||e.pointerType=="touch"&&e,!this.nativeDraggable||i?this.options.supportPointer?C(document,"pointermove",this._onTouchMove):i?C(document,"touchmove",this._onTouchMove):C(document,"mousemove",this._onTouchMove):(C(c,"dragend",this),C(O,"dragstart",this._onDragStart));try{document.selection?oe(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,i){if(Ct=!1,O&&c){H("dragStarted",this,{evt:i}),this.nativeDraggable&&C(document,"dragover",vn);var n=this.options;!e&&G(c,n.dragClass,!1),G(c,n.ghostClass,!0),v.active=this,e&&this._appendGhost(),X({sortable:this,name:"start",originalEvent:i})}else this._nulling()},_emulateDragOver:function(){if(J){this._lastX=J.clientX,this._lastY=J.clientY,Ei();for(var e=document.elementFromPoint(J.clientX,J.clientY),i=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(J.clientX,J.clientY),e!==i);)i=e;if(c.parentNode[q]._isOutsideThisEl(e),i)do{if(i[q]){var n=void 0;if(n=i[q]._onDragOver({clientX:J.clientX,clientY:J.clientY,target:e,rootEl:i}),n&&!this.options.dragoverBubble)break}e=i}while(i=i.parentNode);Si()}},_onTouchMove:function(e){if(yt){var i=this.options,n=i.fallbackTolerance,o=i.fallbackOffset,r=e.touches?e.touches[0]:e,s=y&&Tt(y,!0),a=y&&s&&s.a,l=y&&s&&s.d,d=Jt&&F&&Ue(F),h=(r.clientX-yt.clientX+o.x)/(a||1)+(d?d[0]-ye[0]:0)/(a||1),p=(r.clientY-yt.clientY+o.y)/(l||1)+(d?d[1]-ye[1]:0)/(l||1);if(!v.active&&!Ct){if(n&&Math.max(Math.abs(r.clientX-this._lastX),Math.abs(r.clientY-this._lastY))<n)return;this._onDragStart(e,!0)}if(y){s?(s.e+=h-(ve||0),s.f+=p-(be||0)):s={a:1,b:0,c:0,d:1,e:h,f:p};var b="matrix(".concat(s.a,",").concat(s.b,",").concat(s.c,",").concat(s.d,",").concat(s.e,",").concat(s.f,")");m(y,"webkitTransform",b),m(y,"mozTransform",b),m(y,"msTransform",b),m(y,"transform",b),ve=h,be=p,J=r}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!y){var e=this.options.fallbackOnBody?document.body:O,i=N(c,!0,Jt,!0,e),n=this.options;if(Jt){for(F=e;m(F,"position")==="static"&&m(F,"transform")==="none"&&F!==document;)F=F.parentNode;F!==document.body&&F!==document.documentElement?(F===document&&(F=it()),i.top+=F.scrollTop,i.left+=F.scrollLeft):F=it(),ye=Ue(F)}y=c.cloneNode(!0),G(y,n.ghostClass,!1),G(y,n.fallbackClass,!0),G(y,n.dragClass,!0),m(y,"transition",""),m(y,"transform",""),m(y,"box-sizing","border-box"),m(y,"margin",0),m(y,"top",i.top),m(y,"left",i.left),m(y,"width",i.width),m(y,"height",i.height),m(y,"opacity","0.8"),m(y,"position",Jt?"absolute":"fixed"),m(y,"zIndex","100000"),m(y,"pointerEvents","none"),v.ghost=y,e.appendChild(y),m(y,"transform-origin",ze/parseInt(y.style.width)*100+"% "+Ge/parseInt(y.style.height)*100+"%")}},_onDragStart:function(e,i){var n=this,o=e.dataTransfer,r=n.options;if(H("dragStart",this,{evt:e}),v.eventCanceled){this._onDrop();return}H("setupClone",this),v.eventCanceled||(L=yi(c),L.removeAttribute("id"),L.draggable=!1,L.style["will-change"]="",this._hideClone(),G(L,this.options.chosenClass,!1),v.clone=L),n.cloneId=oe(function(){H("clone",n),!v.eventCanceled&&(n.options.removeCloneOnHide||O.insertBefore(L,c),n._hideClone(),X({sortable:n,name:"clone"}))}),!i&&G(c,r.dragClass,!0),i?(le=!0,n._loopId=setInterval(n._emulateDragOver,50)):(E(document,"mouseup",n._onDrop),E(document,"touchend",n._onDrop),E(document,"touchcancel",n._onDrop),o&&(o.effectAllowed="move",r.setData&&r.setData.call(n,o,c)),C(document,"drop",n),m(c,"transform","translateZ(0)")),Ct=!0,n._dragStartId=oe(n._dragStarted.bind(n,i,e)),C(document,"selectstart",n),Rt=!0,Yt&&m(document.body,"user-select","none")},_onDragOver:function(e){var i=this.el,n=e.target,o,r,s,a=this.options,l=a.group,d=v.active,h=Zt===l,p=a.sort,b=k||d,I,w=this,S=!1;if(De)return;function B(xt,Ti){H(xt,w,nt({evt:e,isOwner:h,axis:I?"vertical":"horizontal",revert:s,dragRect:o,targetRect:r,canSort:p,fromSortable:b,target:n,completed:V,onMove:function(Fe,Di){return te(O,i,c,o,Fe,N(Fe),e,Di)},changed:Q},Ti))}function R(){B("dragOverAnimationCapture"),w.captureAnimationState(),w!==b&&b.captureAnimationState()}function V(xt){return B("dragOverCompleted",{insertion:xt}),xt&&(h?d._hideClone():d._showClone(w),w!==b&&(G(c,k?k.options.ghostClass:d.options.ghostClass,!1),G(c,a.ghostClass,!0)),k!==w&&w!==v.active?k=w:w===v.active&&k&&(k=null),b===w&&(w._ignoreWhileAnimating=n),w.animateAll(function(){B("dragOverAnimationComplete"),w._ignoreWhileAnimating=null}),w!==b&&(b.animateAll(),b._ignoreWhileAnimating=null)),(n===c&&!c.animated||n===i&&!n.animated)&&(St=null),!a.dragoverBubble&&!e.rootEl&&n!==document&&(c.parentNode[q]._isOutsideThisEl(e.target),!xt&&_t(e)),!a.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),S=!0}function Q(){j=Z(c),pt=Z(c,a.draggable),X({sortable:w,name:"change",toEl:i,newIndex:j,newDraggableIndex:pt,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),n=et(n,a.draggable,i,!0),B("dragOver"),v.eventCanceled)return S;if(c.contains(e.target)||n.animated&&n.animatingX&&n.animatingY||w._ignoreWhileAnimating===n)return V(!1);if(le=!1,d&&!a.disabled&&(h?p||(s=P!==O):k===this||(this.lastPutMode=Zt.checkPull(this,d,c,e))&&l.checkPut(this,d,c,e))){if(I=this._getDirection(e,n)==="vertical",o=N(c),B("dragOverValid"),v.eventCanceled)return S;if(s)return P=O,R(),this._hideClone(),B("revert"),v.eventCanceled||(wt?O.insertBefore(c,wt):O.appendChild(c)),V(!0);var W=xe(i,a.draggable);if(!W||wn(e,I,this)&&!W.animated){if(W===c)return V(!1);if(W&&i===e.target&&(n=W),n&&(r=N(n)),te(O,i,c,o,n,r,e,!!n)!==!1)return R(),W&&W.nextSibling?i.insertBefore(c,W.nextSibling):i.appendChild(c),P=i,Q(),V(!0)}else if(W&&_n(e,I,this)){var mt=Dt(i,0,a,!0);if(mt===c)return V(!1);if(n=mt,r=N(n),te(O,i,c,o,n,r,e,!1)!==!1)return R(),i.insertBefore(c,mt),P=i,Q(),V(!0)}else if(n.parentNode===i){r=N(n);var tt=0,vt,Lt=c.parentNode!==i,U=!gn(c.animated&&c.toRect||o,n.animated&&n.toRect||r,I),Pt=I?"top":"left",dt=We(n,"top","top")||We(c,"top","top"),Mt=dt?dt.scrollTop:void 0;St!==n&&(vt=r[Pt],Ut=!1,Qt=!U&&a.invertSwap||Lt),tt=In(e,n,r,I,U?1:a.swapThreshold,a.invertedSwapThreshold==null?a.swapThreshold:a.invertedSwapThreshold,Qt,St===n);var ot;if(tt!==0){var bt=Z(c);do bt-=tt,ot=P.children[bt];while(ot&&(m(ot,"display")==="none"||ot===y))}if(tt===0||ot===n)return V(!1);St=n,Wt=tt;var $t=n.nextElementSibling,ct=!1;ct=tt===1;var qt=te(O,i,c,o,n,r,e,ct);if(qt!==!1)return(qt===1||qt===-1)&&(ct=qt===1),De=!0,setTimeout(yn,30),R(),ct&&!$t?i.appendChild(c):n.parentNode.insertBefore(c,ct?$t:n),dt&&bi(dt,0,Mt-dt.scrollTop),P=c.parentNode,vt!==void 0&&!Qt&&(ne=Math.abs(vt-N(n)[Pt])),Q(),V(!0)}if(i.contains(c))return V(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){E(document,"mousemove",this._onTouchMove),E(document,"touchmove",this._onTouchMove),E(document,"pointermove",this._onTouchMove),E(document,"dragover",_t),E(document,"mousemove",_t),E(document,"touchmove",_t)},_offUpEvents:function(){var e=this.el.ownerDocument;E(e,"mouseup",this._onDrop),E(e,"touchend",this._onDrop),E(e,"pointerup",this._onDrop),E(e,"touchcancel",this._onDrop),E(document,"selectstart",this)},_onDrop:function(e){var i=this.el,n=this.options;if(j=Z(c),pt=Z(c,n.draggable),H("drop",this,{evt:e}),P=c&&c.parentNode,j=Z(c),pt=Z(c,n.draggable),v.eventCanceled){this._nulling();return}Ct=!1,Qt=!1,Ut=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Oe(this.cloneId),Oe(this._dragStartId),this.nativeDraggable&&(E(document,"drop",this),E(i,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Yt&&m(document.body,"user-select",""),m(c,"transform",""),e&&(Rt&&(e.cancelable&&e.preventDefault(),!n.dropBubble&&e.stopPropagation()),y&&y.parentNode&&y.parentNode.removeChild(y),(O===P||k&&k.lastPutMode!=="clone")&&L&&L.parentNode&&L.parentNode.removeChild(L),c&&(this.nativeDraggable&&E(c,"dragend",this),_e(c),c.style["will-change"]="",Rt&&!Ct&&G(c,k?k.options.ghostClass:this.options.ghostClass,!1),G(c,this.options.chosenClass,!1),X({sortable:this,name:"unchoose",toEl:P,newIndex:null,newDraggableIndex:null,originalEvent:e}),O!==P?(j>=0&&(X({rootEl:P,name:"add",toEl:P,fromEl:O,originalEvent:e}),X({sortable:this,name:"remove",toEl:P,originalEvent:e}),X({rootEl:P,name:"sort",toEl:P,fromEl:O,originalEvent:e}),X({sortable:this,name:"sort",toEl:P,originalEvent:e})),k&&k.save()):j!==At&&j>=0&&(X({sortable:this,name:"update",toEl:P,originalEvent:e}),X({sortable:this,name:"sort",toEl:P,originalEvent:e})),v.active&&((j==null||j===-1)&&(j=At,pt=Ht),X({sortable:this,name:"end",toEl:P,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){H("nulling",this),O=c=P=y=wt=L=ie=ft=yt=J=Rt=j=pt=At=Ht=St=Wt=k=Zt=v.dragged=v.ghost=v.clone=v.active=null,ce.forEach(function(e){e.checked=!0}),ce.length=ve=be=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":c&&(this._onDragOver(e),bn(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],i,n=this.el.children,o=0,r=n.length,s=this.options;o<r;o++)i=n[o],et(i,s.draggable,this.el,!1)&&e.push(i.getAttribute(s.dataIdAttr)||Sn(i));return e},sort:function(e,i){var n={},o=this.el;this.toArray().forEach(function(r,s){var a=o.children[s];et(a,this.options.draggable,o,!1)&&(n[r]=a)},this),i&&this.captureAnimationState(),e.forEach(function(r){n[r]&&(o.removeChild(n[r]),o.appendChild(n[r]))}),i&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,i){return et(e,i||this.options.draggable,this.el,!1)},option:function(e,i){var n=this.options;if(i===void 0)return n[e];var o=jt.modifyOption(this,e,i);typeof o<"u"?n[e]=o:n[e]=i,e==="group"&&Ii(n)},destroy:function(){H("destroy",this);var e=this.el;e[q]=null,E(e,"mousedown",this._onTapStart),E(e,"touchstart",this._onTapStart),E(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(E(e,"dragover",this),E(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(i){i.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),de.splice(de.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!ft){if(H("hideClone",this),v.eventCanceled)return;m(L,"display","none"),this.options.removeCloneOnHide&&L.parentNode&&L.parentNode.removeChild(L),ft=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(ft){if(H("showClone",this),v.eventCanceled)return;c.parentNode==O&&!this.options.group.revertClone?O.insertBefore(L,c):wt?O.insertBefore(L,wt):O.appendChild(L),this.options.group.revertClone&&this.animate(c,L),m(L,"display",""),ft=!1}}};function bn(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move"),t.cancelable&&t.preventDefault()}function te(t,e,i,n,o,r,s,a){var l,d=t[q],h=d.options.onMove,p;return window.CustomEvent&&!lt&&!Gt?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=e,l.from=t,l.dragged=i,l.draggedRect=n,l.related=o||e,l.relatedRect=r||N(e),l.willInsertAfter=a,l.originalEvent=s,t.dispatchEvent(l),h&&(p=h.call(d,l,s)),p}function _e(t){t.draggable=!1}function yn(){De=!1}function _n(t,e,i){var n=N(Dt(i.el,0,i.options,!0)),o=10;return e?t.clientX<n.left-o||t.clientY<n.top&&t.clientX<n.right:t.clientY<n.top-o||t.clientY<n.bottom&&t.clientX<n.left}function wn(t,e,i){var n=N(xe(i.el,i.options.draggable)),o=10;return e?t.clientX>n.right+o||t.clientX<=n.right&&t.clientY>n.bottom&&t.clientX>=n.left:t.clientX>n.right&&t.clientY>n.top||t.clientX<=n.right&&t.clientY>n.bottom+o}function In(t,e,i,n,o,r,s,a){var l=n?t.clientY:t.clientX,d=n?i.height:i.width,h=n?i.top:i.left,p=n?i.bottom:i.right,b=!1;if(!s){if(a&&ne<d*o){if(!Ut&&(Wt===1?l>h+d*r/2:l<p-d*r/2)&&(Ut=!0),Ut)b=!0;else if(Wt===1?l<h+ne:l>p-ne)return-Wt}else if(l>h+d*(1-o)/2&&l<p-d*(1-o)/2)return En(e)}return b=b||s,b&&(l<h+d*r/2||l>p-d*r/2)?l>h+d/2?1:-1:0}function En(t){return Z(c)<Z(t)?1:-1}function Sn(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,i=e.length,n=0;i--;)n+=e.charCodeAt(i);return n.toString(36)}function Cn(t){ce.length=0;for(var e=t.getElementsByTagName("input"),i=e.length;i--;){var n=e[i];n.checked&&ce.push(n)}}function oe(t){return setTimeout(t,0)}function Oe(t){return clearTimeout(t)}he&&C(document,"touchmove",function(t){(v.active||Ct)&&t.cancelable&&t.preventDefault()});v.utils={on:C,off:E,css:m,find:mi,is:function(e,i){return!!et(e,i,e,!1)},extend:an,throttle:vi,closest:et,toggleClass:G,clone:yi,index:Z,nextTick:oe,cancelNextTick:Oe,detectDirection:wi,getChild:Dt};v.get=function(t){return t[q]};v.mount=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];e[0].constructor===Array&&(e=e[0]),e.forEach(function(n){if(!n.prototype||!n.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(n));n.utils&&(v.utils=nt(nt({},v.utils),n.utils)),jt.mount(n)})};v.create=function(t,e){return new v(t,e)};v.version=on;var x=[],Vt,Le,Pe=!1,we,Ie,ue,Xt;function An(){function t(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return t.prototype={dragStarted:function(i){var n=i.originalEvent;this.sortable.nativeDraggable?C(document,"dragover",this._handleAutoScroll):this.options.supportPointer?C(document,"pointermove",this._handleFallbackAutoScroll):n.touches?C(document,"touchmove",this._handleFallbackAutoScroll):C(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(i){var n=i.originalEvent;!this.options.dragOverBubble&&!n.rootEl&&this._handleAutoScroll(n)},drop:function(){this.sortable.nativeDraggable?E(document,"dragover",this._handleAutoScroll):(E(document,"pointermove",this._handleFallbackAutoScroll),E(document,"touchmove",this._handleFallbackAutoScroll),E(document,"mousemove",this._handleFallbackAutoScroll)),qe(),re(),ln()},nulling:function(){ue=Le=Vt=Pe=Xt=we=Ie=null,x.length=0},_handleFallbackAutoScroll:function(i){this._handleAutoScroll(i,!0)},_handleAutoScroll:function(i,n){var o=this,r=(i.touches?i.touches[0]:i).clientX,s=(i.touches?i.touches[0]:i).clientY,a=document.elementFromPoint(r,s);if(ue=i,n||this.options.forceAutoScrollFallback||Gt||lt||Yt){Ee(i,this.options,a,n);var l=gt(a,!0);Pe&&(!Xt||r!==we||s!==Ie)&&(Xt&&qe(),Xt=setInterval(function(){var d=gt(document.elementFromPoint(r,s),!0);d!==l&&(l=d,re()),Ee(i,o.options,d,n)},10),we=r,Ie=s)}else{if(!this.options.bubbleScroll||gt(a,!0)===it()){re();return}Ee(i,this.options,gt(a,!1),!1)}}},at(t,{pluginName:"scroll",initializeByDefault:!0})}function re(){x.forEach(function(t){clearInterval(t.pid)}),x=[]}function qe(){clearInterval(Xt)}var Ee=vi(function(t,e,i,n){if(e.scroll){var o=(t.touches?t.touches[0]:t).clientX,r=(t.touches?t.touches[0]:t).clientY,s=e.scrollSensitivity,a=e.scrollSpeed,l=it(),d=!1,h;Le!==i&&(Le=i,re(),Vt=e.scroll,h=e.scrollFn,Vt===!0&&(Vt=gt(i,!0)));var p=0,b=Vt;do{var I=b,w=N(I),S=w.top,B=w.bottom,R=w.left,V=w.right,Q=w.width,W=w.height,mt=void 0,tt=void 0,vt=I.scrollWidth,Lt=I.scrollHeight,U=m(I),Pt=I.scrollLeft,dt=I.scrollTop;I===l?(mt=Q<vt&&(U.overflowX==="auto"||U.overflowX==="scroll"||U.overflowX==="visible"),tt=W<Lt&&(U.overflowY==="auto"||U.overflowY==="scroll"||U.overflowY==="visible")):(mt=Q<vt&&(U.overflowX==="auto"||U.overflowX==="scroll"),tt=W<Lt&&(U.overflowY==="auto"||U.overflowY==="scroll"));var Mt=mt&&(Math.abs(V-o)<=s&&Pt+Q<vt)-(Math.abs(R-o)<=s&&!!Pt),ot=tt&&(Math.abs(B-r)<=s&&dt+W<Lt)-(Math.abs(S-r)<=s&&!!dt);if(!x[p])for(var bt=0;bt<=p;bt++)x[bt]||(x[bt]={});(x[p].vx!=Mt||x[p].vy!=ot||x[p].el!==I)&&(x[p].el=I,x[p].vx=Mt,x[p].vy=ot,clearInterval(x[p].pid),(Mt!=0||ot!=0)&&(d=!0,x[p].pid=setInterval(function(){n&&this.layer===0&&v.active._onTouchMove(ue);var $t=x[this.layer].vy?x[this.layer].vy*a:0,ct=x[this.layer].vx?x[this.layer].vx*a:0;typeof h=="function"&&h.call(v.dragged.parentNode[q],ct,$t,t,ue,x[this.layer].el)!=="continue"||bi(x[this.layer].el,ct,$t)}.bind({layer:p}),24))),p++}while(e.bubbleScroll&&b!==l&&(b=gt(b,!1)));Pe=d}},30),Ci=function(e){var i=e.originalEvent,n=e.putSortable,o=e.dragEl,r=e.activeSortable,s=e.dispatchSortableEvent,a=e.hideGhostForTarget,l=e.unhideGhostForTarget;if(i){var d=n||r;a();var h=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:i,p=document.elementFromPoint(h.clientX,h.clientY);l(),d&&!d.el.contains(p)&&(s("spill"),this.onSpill({dragEl:o,putSortable:n}))}};function Ne(){}Ne.prototype={startIndex:null,dragStart:function(e){var i=e.oldDraggableIndex;this.startIndex=i},onSpill:function(e){var i=e.dragEl,n=e.putSortable;this.sortable.captureAnimationState(),n&&n.captureAnimationState();var o=Dt(this.sortable.el,this.startIndex,this.options);o?this.sortable.el.insertBefore(i,o):this.sortable.el.appendChild(i),this.sortable.animateAll(),n&&n.animateAll()},drop:Ci};at(Ne,{pluginName:"revertOnSpill"});function ke(){}ke.prototype={onSpill:function(e){var i=e.dragEl,n=e.putSortable,o=n||this.sortable;o.captureAnimationState(),i.parentNode&&i.parentNode.removeChild(i),o.animateAll()},drop:Ci};at(ke,{pluginName:"removeOnSpill"});v.mount(new An);v.mount(ke,Ne);function Ke(t,e,i){t.splice(i,0,t.splice(e,1)[0])}const Tn="esri-layerlist-new-ui",Dn=Ot.ofType($e),Ze="data-sort-filter",Qe="data-layer-uid",On="layerUid",M="esri-layer-list",D=`${M}__item`,u={base:`${M} esri-widget esri-widget--panel`,newUI:`${M}--new-ui`,noItems:`${M}__no-items`,list:`${M}__list`,listRoot:`${M}__list--root`,listExclusive:`${M}__list--exclusive`,listInherited:`${M}__list--inherited`,listIndependent:`${M}__list--independent`,item:D,itemContent:`${D}-content`,itemMessage:`${D}--has-message`,itemInvisible:`${D}--invisible`,itemInvisibleAtScale:`${D}--invisible-at-scale`,itemChildren:`${D}--has-children`,itemSelectable:`${D}--selectable`,itemContainer:`${D}-container`,actionsMenu:`${D}-actions-menu`,actionsMenuItem:`${D}-actions-menu-item`,actionsMenuItemActive:`${D}-actions-menu-item--active`,actions:`${D}-actions`,actionsList:`${D}-actions-list`,action:`${D}-action`,actionIcon:`${D}-action-icon`,actionImage:`${D}-action-image`,actionTitle:`${D}-action-title`,actionToggle:`${M}__action-toggle`,actionToggleOn:`${M}__action-toggle--on`,label:`${D}-label`,message:`${D}-message`,title:`${D}-title`,statusIndicator:`${M}__status-indicator`,publishing:`${M}__publishing`,updating:`${M}__updating`,connectionStatus:`${M}__connection-status`,connectionStatusConnected:`${M}__connection-status--connected`,toggleVisible:`${D}-toggle`,toggleVisibleIcon:`${D}-toggle-icon`,toggleIcon:`${D}-toggle-icon`,radioIcon:`${D}-radio-icon`,childToggle:`${M}__child-toggle`,childToggleOpen:`${M}__child-toggle--open`,childOpened:`${M}__child-toggle-icon--opened`,childClosed:`${M}__child-toggle-icon--closed`,childClosed_RTL:`${M}__child-toggle-icon--closed-rtl`,sortableChosen:`${M}--chosen`,disabled:"esri-disabled",disabledElement:"esri-disabled-element",hidden:"esri-hidden",rotating:"esri-rotating",iconEllipses:"esri-icon-handle-horizontal",iconVisible:"esri-icon-visible",iconInvisible:"esri-icon-non-visible",iconRadioSelected:"esri-icon-radio-checked",iconRadioUnselected:"esri-icon-radio-unchecked",iconNoticeTriangle:"esri-icon-notice-triangle",iconChildrenOpen:"esri-icon-down-arrow",iconDownArrow:"esri-icon-down-arrow",iconRightArrow:"esri-icon-right-triangle-arrow",iconLeftArrow:"esri-icon-left-triangle-arrow",iconLoading:"esri-icon-loading-indicator",iconDefaultAction:"esri-icon-default-action",widgetIcon:"esri-icon-layers"},Se={actions:"actions",actionSection:"action-section",items:"items"},kt={exclusive:"exclusive",inherited:"inherited",independent:"independent"};function Ai(t){const{actionsOpen:e,children:i}=t;e&&(t.actionsOpen=!1),i.forEach(n=>Ai(n))}const Ce="root",Je={statusIndicators:!0,errors:!1};let T=class extends oi{constructor(t,e){super(t,e),this._handles=new Me,this._sortableNodes=new Map,this._sortableMap=new Map,this._focusSortUid=null,this._newUI=xi(Tn),this._tooltipReferenceMap=new Map,this.visibleItems=null,this.iconClass=u.widgetIcon,this.listItemCanGiveFunction=null,this.listItemCanReceiveFunction=null,this.messages=null,this.messagesCommon=null,this.multipleSelectionEnabled=!1,this.selectionEnabled=!1,this.selectedItems=new Dn,this.viewModel=new hi,this.visibleElements={...Je},this._onSortableSort=({to:i,from:n,item:o,newIndex:r})=>{n&&i&&(n===i?this._sortLayers(this._sortableMap.get(n.dataset.group)):this._moveLayerFromChildList({to:i,from:n,item:o,newIndex:r}))},this._sortableCanSort=(i,n)=>!(!i.el.dataset.group||!n.el.dataset.group),this._sortableCanPull=(i,n,o)=>{const{listItemCanGiveFunction:r}=this,s={selected:o["data-item"],from:n.el["data-item"],to:i.el["data-item"]};return!this._sortableCanSort(i,n)||typeof r!="function"||r.call(null,s)},this._sortableCanPut=(i,n,o)=>{const{listItemCanReceiveFunction:r}=this,s={selected:o["data-item"],from:n.el["data-item"],to:i.el["data-item"]};return!this._sortableCanSort(i,n)||typeof r!="function"||r.call(null,s)},this._onSortableEnd=({oldIndex:i,from:n,to:o,item:r})=>{n!==o&&n.insertBefore(r,n.children[i])}}initialize(){const t=this.operationalItems;this._setVisibleItems(t),this.addHandles([Ni(()=>this.operationalItems,"change",()=>this._itemsChanged(t)),$(()=>this.visibleElements,()=>this._itemsChanged(t)),$(()=>this.selectionEnabled,()=>this._toggleAllSorting(),Y)])}loadDependencies(){return Promise.all([Ae(()=>import("./calcite-icon-cb25997d.js"),["assets/calcite-icon-cb25997d.js","assets/icon-80a1e882.js","assets/widget-4447051f.js","assets/index-1de34779.js","assets/index-252dcfb5.css","assets/uuid-73213768.js","assets/observers-4f67f1fb.js"]),Ae(()=>import("./calcite-tooltip-b87ee794.js"),["assets/calcite-tooltip-b87ee794.js","assets/tooltip-b3f13c31.js","assets/widget-4447051f.js","assets/index-1de34779.js","assets/index-252dcfb5.css","assets/uuid-73213768.js","assets/debounce-31e0cfcc.js","assets/guid-9426053f.js"])])}destroy(){this._destroySortables(),this._tooltipReferenceMap.clear(),this._handles.destroy(),this._handles=null}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get listItemCreatedFunction(){return this.viewModel.listItemCreatedFunction}set listItemCreatedFunction(t){this.viewModel.listItemCreatedFunction=t}get operationalItems(){return this.viewModel.operationalItems}set operationalItems(t){this.viewModel.operationalItems=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}castVisibleElements(t){return{...Je,...t}}triggerAction(t,e){return this.viewModel.triggerAction(t,e)}render(){var s;const{visibleItems:t,_newUI:e}=this,i=(s=this.viewModel)==null?void 0:s.state,n={[u.newUI]:e,[u.hidden]:i==="loading",[u.disabled]:i==="disabled"},o=this.renderItemTooltips(),r=this.renderItems();return _("div",{class:this.classes(u.base,n)},t!=null&&t.length?[o,r]:this.renderNoItems())}renderItemTooltip(t){const{_tooltipReferenceMap:e,messages:i}=this;return t?_("calcite-tooltip",{label:i.layerIncompatible,referenceElement:e.get(t.uid)},i.layerIncompatibleTooltip):null}renderItemTooltipNodes(t){const{incompatible:e,children:i}=t;return[e?this.renderItemTooltip(t):null,...e?[]:i==null?void 0:i.toArray().map(n=>this.renderItemTooltipNodes(n))]}renderItemTooltips(){return this.visibleItems.toArray().map(t=>this.renderItemTooltipNodes(t))}renderNoItems(){return _("div",{class:u.noItems},this.messages.noItemsToDisplay)}renderItems(){const{visibleItems:t,selectionEnabled:e,messages:i}=this;return _("ul",{"aria-label":i.widgetLabel,role:e?"listbox":void 0,afterCreate:this._sortNodeCreated,afterUpdate:this._sortNodeCreated,afterRemoved:this._sortNodeRemoved,"data-group":Ce,bind:this,class:this.classes(u.list,u.listRoot,u.listIndependent)},t==null?void 0:t.map(n=>this.renderItem(n,null)).toArray())}renderActionsMenuIcon(t,e){const{messagesCommon:i}=this,n={[u.actionsMenuItemActive]:t.actionsOpen};return _("div",{key:"actions-menu-toggle","data-item":t,bind:this,onclick:this._toggleActionsOpen,onkeydown:this._toggleActionsOpen,class:this.classes(u.actionsMenuItem,n),tabindex:"0",role:"button","aria-controls":e,"aria-label":i.options,title:i.options},_("span",{"aria-hidden":"true",class:u.iconEllipses}))}renderActionsMenu(t,e,i,n){const{panel:o}=t,r=o&&o.visible?this.renderPanelButton(o):null,s=i===1&&this._getSingleActionButton(e),a=s?this.renderAction({item:t,action:s,singleAction:!0}):null,l=!s&&i?this.renderActionsMenuIcon(t,n):null;return l||r||s?_("div",{key:"actions-menu",class:u.actionsMenu},r,a,l):null}renderChildList(t,e){var h;const{selectionEnabled:i}=this,{visibilityMode:n,children:o}=t,r=this._hasChildren(t),s=!r&&i&&((h=t.layer)==null?void 0:h.type)==="group",{exclusive:a,inherited:l}=kt,d={[u.listExclusive]:n===a,[u.listInherited]:n===l,[u.listIndependent]:n!==l&&n!==a};return r||s?_("ul",{bind:this,key:"list-items",id:e,"data-group":t.uid,"data-item":t,afterCreate:this._sortNodeCreated,afterUpdate:this._sortNodeCreated,afterRemoved:this._sortNodeRemoved,class:this.classes(u.list,d),"aria-expanded":t.open?"true":"false",role:i?"listbox":n===a?"radiogroup":"group",hidden:!t.open&&!s||null},o==null?void 0:o.map(p=>this.renderItem(p,t)).toArray()):null}renderChildrenToggle(t,e){const{messagesCommon:i}=this,n=this._hasChildren(t),o={[u.childToggleOpen]:t.open},r=t.open?i.collapse:i.expand;return n?_("span",{onclick:this._toggleChildrenClick,onkeydown:this._toggleChildrenClick,"data-item":t,key:"toggle-children",class:this.classes(u.childToggle,o),tabindex:"0",role:"button","aria-controls":e,"aria-label":r,title:r},_("span",{"aria-hidden":"true",class:this.classes(u.childClosed,u.iconRightArrow)}),_("span",{"aria-hidden":"true",class:this.classes(u.childOpened,u.iconDownArrow)}),_("span",{"aria-hidden":"true",class:this.classes(u.childClosed_RTL,u.iconLeftArrow)})):null}renderItemMessage(t){return t.error?_("div",{key:"esri-layer-list__error",class:u.message,role:"alert"},_("span",{"aria-hidden":"true",class:u.iconNoticeTriangle}),this.messages.layerError):t.incompatible?_("div",{key:"esri-layer-list__incompatible",class:u.message,role:"alert"},_("span",{bind:this,tabIndex:0,"aria-hidden":"true",class:u.iconNoticeTriangle,afterCreate:e=>this._setTooltipReference(e,t)}),this.messages.layerIncompatible):null}renderItemContent(t,e,i){const{id:n}=this,o=`${n}_${t.uid}`,r=`${o}_actions`,s=`${o}__list`,{panel:a}=t,l=this._filterActions(t.actionsSections),d=this._countActions(l);return[_("div",{key:"list-item-container",class:u.itemContainer},this.renderChildrenToggle(t,s),this.renderLabel(t,e,i),this.renderActionsMenu(t,l,d,r)),this.renderItemMessage(t),d?this.renderActionsSections(t,l,r):null,a&&a.open&&!a.disabled?a.render():null,this.renderChildList(t,s)]}renderItem(t,e){var h;const{_newUI:i,id:n,selectionEnabled:o,selectedItems:r}=this,s=`${`${n}_${t.uid}`}__title`,a=this._hasMessage(t),l=this._hasChildren(t),d={[u.itemChildren]:l,[u.itemMessage]:!!a,[u.itemInvisible]:i&&!t.visible,[u.itemInvisibleAtScale]:!t.visibleAtCurrentScale,[u.itemSelectable]:o};if(o){const p={[Qe]:(h=t.layer)==null?void 0:h.uid,[Ze]:(!t.sortable).toString()};return _("li",{key:`item-with-selection-${t.uid}`,bind:this,afterCreate:this._focusListItem,afterUpdate:this._focusListItem,class:this.classes(u.item,d),"aria-labelledby":s,onclick:this._toggleSelection,onkeydown:this._selectionKeydown,"data-item":t,"data-group":e?e.uid:Ce,tabIndex:0,"aria-selected":pe(t,r)?"true":"false",role:"option",...p},this.renderItemContent(t,e,s))}return _("li",{key:`item-no-selection-${t.uid}`,bind:this,afterCreate:this._focusListItem,afterUpdate:this._focusListItem,class:this.classes(u.item,d),"aria-labelledby":s},this.renderItemContent(t,e,s))}renderConnectionIcon(t){const{connectionStatus:e}=t;return ii(e)?_("calcite-icon",{icon:e==="connected"?"check-circle":"offline",scale:"s"}):null}renderItemStatus(t,e){const{visibleElements:i}=this;if(!i.statusIndicators)return null;const{connectionStatus:n,publishing:o,updating:r}=t,s=r&&!e,a=!!n;return _("span",{class:this.classes({[u.statusIndicator]:!0,[u.publishing]:o,[u.updating]:s,[u.connectionStatus]:a,[u.connectionStatusConnected]:a&&n==="connected"}),key:"layer-item-status"},this.renderConnectionIcon(t))}renderItemTitle(t,e){const{messages:i}=this;if(!t)return null;const n=t.title||i.untitledLayer,o=t.visibleAtCurrentScale?n:`${n} (${i.layerInvisibleAtScale})`;return _("span",{key:"layer-title-container",id:e,title:o,"aria-label":o,class:u.title},n)}renderItemToggleIcon(t,e){const{_newUI:i}=this,{exclusive:n}=kt,o=e&&e.visibilityMode,r={[u.toggleVisibleIcon]:i,[u.toggleIcon]:i&&o!==n,[u.radioIcon]:i&&o===n,[u.iconRadioSelected]:o===n&&t.visible,[u.iconRadioUnselected]:o===n&&!t.visible,[u.iconVisible]:o!==n&&t.visible,[u.iconInvisible]:o!==n&&!t.visible};return _("span",{key:"item-toggle-icon",class:this.classes(r),"aria-hidden":"true"})}renderItemToggle(t,e,i){const{selectionEnabled:n,messages:o}=this,{exclusive:r}=kt,s=e&&e.visibilityMode,a=s===r?"radio":"switch";return _("span",n?{key:"item-toggle-selection-enabled",class:u.toggleVisible,bind:this,onclick:this._toggleVisibility,onkeydown:this._toggleVisibility,"data-item":t,"data-parent-visibility":s,tabIndex:0,title:t.visible?o.hideLayer:o.showLayer,"aria-checked":t.visible?"true":"false",role:a,"aria-labelledby":i}:{key:"item-toggle",class:u.toggleVisible},this.renderItemToggleIcon(t,e))}renderLabel(t,e,i){const{selectionEnabled:n,_newUI:o,messages:r}=this,{inherited:s,exclusive:a}=kt,l=e==null?void 0:e.visibilityMode,d=l===a?"radio":"switch",h=o?[this.renderItemTitle(t,i),this.renderItemStatus(t,e),this.renderItemToggle(t,e,i)]:[this.renderItemToggle(t,e,i),this.renderItemTitle(t,i),this.renderItemStatus(t,e)],p=_("div",n?{key:`item-label-no-selection-${t.uid}`,class:u.label}:{key:`item-label-with-selection-${t.uid}`,class:u.label,bind:this,onclick:this._toggleVisibility,onkeydown:this._toggleVisibility,"data-item":t,"data-parent-visibility":l,tabIndex:0,"aria-checked":t.visible?"true":"false",title:t.visible?r.hideLayer:r.showLayer,role:d,"aria-labelledby":i},h);return l===s||t.error?_("div",{key:`item-label-container-${t.uid}`,class:u.label},this.renderItemTitle(t,i),this.renderItemStatus(t,e)):p}renderPanelButton(t){const{className:e,open:i,title:n,image:o}=t,r=o||e?e:u.iconDefaultAction,s=this._getIconImageStyles(t),a={[u.actionsMenuItemActive]:i},l={[u.actionImage]:!!s["background-image"],[u.disabledElement]:t.disabled};return r&&(l[r]=!!r),_("div",{"aria-disabled":t.disabled.toString(),key:`panel-${t.uid}`,bind:this,"data-panel":t,onclick:this._triggerPanel,onkeydown:this._triggerPanel,class:this.classes(u.actionsMenuItem,a),role:"button",tabindex:t.disabled?null:0,title:n,"aria-label":n},_("span",{class:this.classes(l),styles:s}))}renderActionsSections(t,e,i){const n=e.toArray().map((o,r)=>_("ul",{key:`${t}-action-section-${r}`,class:u.actionsList},this.renderActionSection(t,o)));return _("div",{role:"group","aria-expanded":t.actionsOpen?"true":"false",key:"actions-section",id:i,class:u.actions,hidden:!t.actionsOpen||null},n)}renderActionSection(t,e){return(e&&e.toArray()).map(i=>this.renderAction({item:t,action:i}))}renderActionIcon(t){const{active:e,className:i}=t,n=this._getIconImageStyles(t),o=t.type!=="button"||t.image||i?i:u.iconDefaultAction,r={[u.actionImage]:!e&&!!n["background-image"],[u.iconLoading]:e,[u.rotating]:e};return o&&!e&&(r[o]=!0),_("span",{key:"action-icon","aria-hidden":"true",class:this.classes(u.actionIcon,r),styles:n})}renderActionTitle(t,e){return e?null:_("span",{key:"action-title",class:u.actionTitle},t)}renderAction(t){const{item:e,action:i,singleAction:n}=t,{active:o,disabled:r,title:s}=i,a={[u.actionsMenuItem]:n&&i.type==="button",[u.action]:o||!n&&i.type!=="toggle",[u.actionToggle]:!o&&i.type==="toggle",[u.actionToggleOn]:!o&&i.type==="toggle"&&i.value,[u.disabledElement]:r},l=[this.renderActionIcon(i),this.renderActionTitle(s,n)];return n?_("div",{bind:this,"data-item":e,"data-action":i,role:"button",key:`single-action-${i.uid}`,onclick:this._triggerAction,onkeydown:this._triggerAction,classes:a,tabindex:"0",title:s,"aria-label":s},l):_("li",{bind:this,"data-item":e,"data-action":i,key:`action-${i.uid}`,onclick:this._triggerAction,onkeydown:this._triggerAction,classes:a,tabindex:"0",role:"button",title:s,"aria-label":s},l)}_setTooltipReference(t,e){this._tooltipReferenceMap.set(e.uid,t),this.scheduleRender()}_hasMessage(t){return!!t.error||t.incompatible}_hasChildren(t){return!!t.children.length&&!this._hasMessage(t)}_sortNodeRemoved(t){const{_sortableMap:e}=this,i=t.dataset.group,n=e.get(i);n&&n.destroy(),e.delete(i)}_destroySortables(){const{_sortableMap:t,_sortableNodes:e}=this;t.forEach(i=>i&&i.destroy()),t.clear(),e.clear()}_moveLayerFromChildList({to:t,from:e,item:i,newIndex:n}){const o=i["data-item"],r=t["data-item"],s=e["data-item"];this.viewModel.moveListItem(o,s,r,n)}_sortLayers(t){var n,o;if(!t)return;const e=t.el["data-item"],i=t.toArray();e?zi(e,i):ai((o=(n=this.view)==null?void 0:n.map)==null?void 0:o.layers,i)}_toggleSorting(t,e){const{_sortableMap:i,selectionEnabled:n}=this,o=i.get(e),r=t["data-item"],s=(e===Ce||r.childrenSortable&&Hi(r))&&n;if(o)o.option("disabled",!s);else if(s){const a=v.create(t,{dataIdAttr:Qe,group:{name:e,pull:this._sortableCanPull,put:this._sortableCanPut},filter:`[${Ze}="true"]`,fallbackTolerance:4,onSort:this._onSortableSort,onEnd:this._onSortableEnd,disabled:!s,chosenClass:u.sortableChosen});i.set(e,a)}}_toggleAllSorting(){this._sortableNodes.forEach((t,e)=>this._toggleSorting(t,e))}_sortNodeCreated(t){const e=t.dataset.group;e&&(this._sortableNodes.set(e,t),this._toggleSorting(t,e))}_setVisibleItems(t){this.visibleItems=t==null?void 0:t.filter(e=>!e.hidden&&(this.visibleElements.errors||!e.error))}_getSingleActionButton(t){return t.reduce(e=>e).filter(e=>e&&e.type==="button").getItemAt(0)}_focusListItem(t){var i;const{_focusSortUid:e}=this;!t||!e||((i=t["data-item"].layer)==null?void 0:i.uid)===e&&(t.focus(),this._focusSortUid=null)}_watchActionSectionChanges(t,e){const i=Se.actionSection+e;this._handles.add(t.on("change",this.scheduleRender.bind(this)),i),t.forEach(n=>this._renderOnActionChanges(n,e))}_renderOnActionChanges(t,e){const i=Se.actions+e;t.type!=="toggle"?t.type!=="slider"?this._handles.add($(()=>[t==null?void 0:t.className,t==null?void 0:t.image,t==null?void 0:t.id,t==null?void 0:t.title,t==null?void 0:t.visible],()=>this.scheduleRender(),Y),i):this._handles.add($(()=>[t==null?void 0:t.className,t==null?void 0:t.id,t==null?void 0:t.title,t==null?void 0:t.visible,t==null?void 0:t.value,t==null?void 0:t.displayValueEnabled,t==null?void 0:t.max,t==null?void 0:t.min,t==null?void 0:t.step],()=>this.scheduleRender(),Y),i):this._handles.add($(()=>[t==null?void 0:t.className,t==null?void 0:t.image,t==null?void 0:t.id,t==null?void 0:t.title,t==null?void 0:t.visible,t==null?void 0:t.value],()=>this.scheduleRender(),Y),i)}_renderOnItemChanges(t){const e=t.uid,i=Se.items+e;this._handles.add([$(()=>{var n,o,r;return[t==null?void 0:t.actionsOpen,t==null?void 0:t.visible,t==null?void 0:t.open,t==null?void 0:t.updating,t==null?void 0:t.connectionStatus,t==null?void 0:t.publishing,t==null?void 0:t.title,t==null?void 0:t.visibleAtCurrentScale,t==null?void 0:t.error,t==null?void 0:t.visibilityMode,t==null?void 0:t.panel,(n=t==null?void 0:t.panel)==null?void 0:n.title,(o=t==null?void 0:t.panel)==null?void 0:o.content,(r=t==null?void 0:t.panel)==null?void 0:r.className,t==null?void 0:t.sortable,t==null?void 0:t.childrenSortable]},()=>this.scheduleRender(),ki),$(()=>[t==null?void 0:t.hidden,t==null?void 0:t.error],()=>this._setVisibleItems(this.operationalItems)),t.actionsSections.on("change",()=>this.scheduleRender()),t.children.on("change",()=>this.scheduleRender())],i),t.children.forEach(n=>this._renderOnItemChanges(n)),t.actionsSections.forEach(n=>this._watchActionSectionChanges(n,e))}_itemsChanged(t){this._handles.removeAll(),t.forEach(e=>this._renderOnItemChanges(e)),this._tooltipReferenceMap.clear(),this._setVisibleItems(t),this.scheduleRender()}_filterActions(t){return t.map(e=>e.filter(i=>i.visible))}_countActions(t){return t.reduce((e,i)=>e+i.length,0)}_getIconImageStyles(t){const e=t.declaredClass==="esri.widgets.LayerList.ListItemPanel"||t.declaredClass==="esri.support.Action.ActionButton"||t.declaredClass==="esri.support.Action.ActionToggle"?t.image:null;return{"background-image":e?`url("${e}")`:null}}_selectionKeydown(t){var I,w,S,B;const e=["ArrowDown","ArrowUp"],i=Fi(t);if(!e.includes(i))return void this._toggleSelection(t);t.stopPropagation();const n=t.currentTarget,o=n["data-item"],{_sortableMap:r,selectedItems:s}=this,a=n.dataset.group,l=r.get(a);if(!l)return;const d=pe(o,s),h=l.toArray(),p=t.target,b=h.indexOf(p.dataset[On]);if(b!==-1){if(i==="ArrowDown"){const R=b+1;if(R>=h.length)return;d?(Ke(h,b,R),l.sort(h),this._sortLayers(l),this._focusSortUid=(I=o.layer)==null?void 0:I.uid):(this._focusSortUid=(w=o.layer)==null?void 0:w.uid,this.scheduleRender())}if(i==="ArrowUp"){const R=b-1;if(R<=-1)return;d?(Ke(h,b,R),l.sort(h),this._sortLayers(l),this._focusSortUid=(S=o.layer)==null?void 0:S.uid):(this._focusSortUid=(B=o.layer)==null?void 0:B.uid,this.scheduleRender())}}}_toggleActionsOpen(t){const e=t.currentTarget["data-item"],{actionsOpen:i}=e,n=!i;n&&this.operationalItems.forEach(o=>Ai(o)),e.actionsOpen=n,t.stopPropagation()}_triggerPanel(t){const e=t.currentTarget["data-panel"];t.stopPropagation(),e&&!e.disabled&&(e.open=!e.open)}_triggerAction(t){const e=t.currentTarget,i=e["data-action"],n=e["data-item"];i.type==="toggle"&&(i.value=!i.value),this.triggerAction(i,n),t.stopPropagation()}_toggleVisibility(t){const e=t.currentTarget,i=e.getAttribute("data-parent-visibility"),n=e["data-item"];i===kt.exclusive&&n.visible||(n.visible=!n.visible),t.stopPropagation()}_toggleChildrenClick(t){const e=t.currentTarget["data-item"];e.open=!e.open,t.stopPropagation()}_toggleSelection(t){var s,a;t.stopPropagation();const{multipleSelectionEnabled:e,selectedItems:i}=this,n=t.currentTarget["data-item"],o=pe(n,i),{length:r}=i;if(!e)return r&&!(o&&r===1)?(i.removeAll(),void i.add(n)):void(o?(s=i.remove)==null?void 0:s.call(i,o):i.add(n));o?(a=i.remove)==null||a.call(i,o):i.add(n)}};f([g()],T.prototype,"visibleItems",void 0),f([g()],T.prototype,"iconClass",void 0),f([g()],T.prototype,"label",null),f([g()],T.prototype,"listItemCanGiveFunction",void 0),f([g()],T.prototype,"listItemCanReceiveFunction",void 0),f([g()],T.prototype,"listItemCreatedFunction",null),f([g(),Ve("esri/widgets/LayerList/t9n/LayerList")],T.prototype,"messages",void 0),f([g(),Ve("esri/t9n/common")],T.prototype,"messagesCommon",void 0),f([g()],T.prototype,"multipleSelectionEnabled",void 0),f([g()],T.prototype,"operationalItems",null),f([g()],T.prototype,"selectionEnabled",void 0),f([g()],T.prototype,"selectedItems",void 0),f([g()],T.prototype,"view",null),f([Ri("trigger-action"),g({type:hi})],T.prototype,"viewModel",void 0),f([g()],T.prototype,"visibleElements",void 0),f([ni("visibleElements")],T.prototype,"castVisibleElements",null),f([It()],T.prototype,"_toggleActionsOpen",null),f([It()],T.prototype,"_triggerPanel",null),f([It()],T.prototype,"_triggerAction",null),f([It()],T.prototype,"_toggleVisibility",null),f([It()],T.prototype,"_toggleChildrenClick",null),f([It()],T.prototype,"_toggleSelection",null),T=f([zt("esri.widgets.LayerList")],T);const kn=T;export{kn as default};
