import{e as o,bf as D,b3 as C,a as S,v as N,y as r,bg as b,j as H,s as c,bh as W,bi as w,z as $,_ as u,aw as T,bb as R,H as B,bj as F,bk as v,bl as G,bm as U,b7 as P,aN as V,i as M,bn as x,bo as Y,a3 as j,g as X,q as O}from"./index-1de34779.js";import{x as Z}from"./Basemap-05b492be.js";import{l as q}from"./loadAll-0643270c.js";import{l as A}from"./CollectionFlattener-69c675dd.js";import{p as z,y as J,m as Q}from"./basemapUtils-d89c0772.js";import{l as k,d as K,t as ee}from"./TablesMixin-a90c4927.js";import"./writeUtils-c3a30ac3.js";var h;let d=h=class extends C{constructor(e){super(e),this.type="none"}clone(){return new h({type:this.type})}};o([D({none:"none",stayAbove:"stay-above"})],d.prototype,"type",void 0),d=h=o([S("esri.ground.NavigationConstraint")],d);let a=class extends N{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1,this.TERRAIN_USE_LEGACY_SHADING=!1}};o([r()],a.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),o([r()],a.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),o([r()],a.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),o([r()],a.prototype,"DECONFLICTOR_SHOW_GRID",void 0),o([r()],a.prototype,"LABELS_SHOW_BORDER",void 0),o([r()],a.prototype,"TEXT_SHOW_BASELINE",void 0),o([r()],a.prototype,"TEXT_SHOW_BORDER",void 0),o([r()],a.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),o([r()],a.prototype,"OVERLAY_SHOW_CENTER",void 0),o([r()],a.prototype,"SHOW_POI",void 0),o([r()],a.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),o([r()],a.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),o([r()],a.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),o([r()],a.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),o([r()],a.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),o([r()],a.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),o([r()],a.prototype,"I3S_TREE_SHOW_TILES",void 0),o([r()],a.prototype,"I3S_SHOW_MODIFICATIONS",void 0),o([r()],a.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),o([r()],a.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),o([r()],a.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),o([r()],a.prototype,"LINE_WIREFRAMES",void 0),o([r()],a.prototype,"TERRAIN_USE_LEGACY_SHADING",void 0),a=o([S("esri.views.3d.support.DebugFlags")],a);const te=new a;var I;let n=I=class extends b(V){constructor(e){super(e),this.opacity=1,this.shading=!te.TERRAIN_USE_LEGACY_SHADING,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new H;const t=s=>{s.parent&&s.parent!==this&&"remove"in s.parent&&s.parent.remove(s),s.parent=this,s.type!=="elevation"&&s.type!=="base-elevation"&&c.getLogger(this.declaredClass).error(`Layer '${s.title}, id:${s.id}' of type '${s.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=s=>{s.parent=null};this.layers.on("after-add",s=>t(s.item)),this.layers.on("after-remove",s=>i(s.item))}initialize(){this.when().catch(e=>{c.getLogger(this.declaredClass).error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)t.destroy();this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set layers(e){this._set("layers",W(e,this._get("layers")))}writeLayers(e,t,i,s){const E=[];e&&(s={...s,layerContainerType:"ground"},e.forEach(p=>{if("write"in p){const y={};w(p)().write(y,s)&&E.push(y)}else s&&s.messages&&s.messages.push(new $("layer:unsupported",`Layers (${p.title}, ${p.id}) of type '${p.declaredClass}' cannot be persisted in the ground`,{layer:p}))})),t.layers=E}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return q(this,e=>{e(this.layers)})}async queryElevation(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:i}=await u(()=>import("./ElevationQuery-a421cafe.js"),["assets/ElevationQuery-a421cafe.js","assets/index-1de34779.js","assets/index-252dcfb5.css","assets/aaBoundingRect-da6cd5b1.js","assets/TileKey-b87e0dc5.js"]);T(t);const s=new i,E=this.layers.filter(g).toArray();return s.queryAll(E,e,t)}async createElevationSampler(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:i}=await u(()=>import("./ElevationQuery-a421cafe.js"),["assets/ElevationQuery-a421cafe.js","assets/index-1de34779.js","assets/index-252dcfb5.css","assets/aaBoundingRect-da6cd5b1.js","assets/TileKey-b87e0dc5.js"]);T(t);const s=new i,E=this.layers.filter(g).toArray();return s.createSamplerAll(E,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:R(this.surfaceColor),navigationConstraint:R(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new I({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve()}_loadLayersFromJSON(e,t,i){const s=t&&t.origin||"web-scene",E=t&&t.portal||null,p=t&&t.url||null;return u(()=>import("./layersCreator-fd3b9550.js"),["assets/layersCreator-fd3b9550.js","assets/index-1de34779.js","assets/index-252dcfb5.css","assets/lazyLayerLoader-f6840b4c.js","assets/portalLayers-2c78974d.js","assets/layersLoader-4e7c645c.js","assets/fetchService-b2a6408d.js","assets/jsonContext-cd669aa2.js"]).then(({populateOperationalLayers:y})=>{T(i);const L=[];if(e.layers&&Array.isArray(e.layers)){const f={context:{origin:s,url:p,portal:E,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};L.push(y(this.layers,e.layers,f))}return B(L)}).then(()=>{})}};function oe(e){return e&&"createElevationSampler"in e}function g(e){return e.type==="elevation"||oe(e)}o([r({json:{read:!1}})],n.prototype,"layers",null),o([F("layers")],n.prototype,"writeLayers",null),o([r({readOnly:!0})],n.prototype,"resourceInfo",void 0),o([r({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:v,read:{reader:G,source:"transparency"},write:{writer:(e,t)=>{t.transparency=U(e)},target:"transparency"}}})],n.prototype,"opacity",void 0),o([r({type:Boolean,nonNullable:!0,json:{read:!1}})],n.prototype,"shading",void 0),o([r({type:P,json:{type:[v],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],n.prototype,"surfaceColor",void 0),o([r({type:d,json:{write:!0}})],n.prototype,"navigationConstraint",void 0),n=I=o([S("esri.Ground")],n);const _=n;function re(e){var t,i;return!(!(e!=null&&e.loaded)||!((i=(t=M(e))==null?void 0:t.operations)!=null&&i.supportsEditing)||"editingEnabled"in e&&!x(e))}const m={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function se(e){let t=null;if(typeof e=="string")if(e in m){const i=m[e];t=new _({resourceInfo:{data:{layers:[i]}}})}else c.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=Y(_,e);return t}let l=class extends k(K(j.EventedMixin(N))){constructor(e){super(e),this.allLayers=new A({getCollections:()=>{var t,i,s;return[(t=this.basemap)==null?void 0:t.baseLayers,(i=this.ground)==null?void 0:i.layers,this.layers,(s=this.basemap)==null?void 0:s.referenceLayers]},getChildrenFunction:t=>"layers"in t?t.layers:null}),this.allTables=ee(this),this.basemap=null,this.editableLayers=new A({getCollections:()=>[this.allLayers],itemFilterFunction:re}),this.ground=new _,this._basemapCache=z()}destroy(){var e,t;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),(e=this.ground)==null||e.destroy(),(t=this.basemap)==null||t.destroy(),J(this._basemapCache),this._basemapCache=null}castBasemap(e){return Q(e,this._basemapCache)}castGround(e){const t=se(e);return X(t)?this._get("ground"):t}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};o([r({readOnly:!0,dependsOn:[]})],l.prototype,"allLayers",void 0),o([r({readOnly:!0})],l.prototype,"allTables",void 0),o([r({type:Z})],l.prototype,"basemap",void 0),o([O("basemap")],l.prototype,"castBasemap",null),o([r({readOnly:!0})],l.prototype,"editableLayers",void 0),o([r({type:_,nonNullable:!0})],l.prototype,"ground",void 0),o([O("ground")],l.prototype,"castGround",null),l=o([S("esri.Map")],l);const de=l;export{de as default};
