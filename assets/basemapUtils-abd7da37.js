import{s as u,x as c}from"./Basemap-11f6c81d.js";import{s as L,bV as o,bo as S,g as s,j as g,n as i,bW as R}from"./index-c754ff65.js";const f=L.getLogger("esri.support.basemapUtils");function U(){return{}}function M(e){for(const a in e){const t=e[a];(t==null?void 0:t.destroyed)===!1&&t.destroy(),delete e[a]}}function j(e,a){let t;if(typeof e=="string"){if(!(e in u)){const l=Object.entries(u).filter(([n,r])=>o.apiKey&&!r.classic||!o.apiKey&&r.classic&&!r.deprecated).map(([n])=>`"${n}"`).join(", ");return f.warn(`Unable to find basemap definition for: ${e}. Try one of these: ${l}`),null}a&&(t=a[e]),t||(t=c.fromId(e),a&&(a[e]=t))}else t=S(c,e);return t!=null&&t.destroyed&&(f.warn("The provided basemap is already destroyed",{basemap:t}),t=null),t}function k(e,a){return e===a?!0:$(p(e),p(a),{mustMatchReferences:!0})==="equal"}function A(e,a){var r;if(s(a)||s(e))return{spatialReference:null,updating:!1};if(a.loadStatus==="not-loaded")return a.load(),{spatialReference:null,updating:!0};if(a.spatialReference)return{spatialReference:a.spatialReference,updating:!1};if(a.baseLayers.length===0)return{spatialReference:null,updating:!1};const t=a.baseLayers.getItemAt(0);switch(t.loadStatus){case"not-loaded":t.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}const l=(("supportedSpatialReferences"in t?t.supportedSpatialReferences:null)||["tileInfo"in t?(r=t.tileInfo)==null?void 0:r.spatialReference:t.spatialReference]).filter(Boolean),n=e.spatialReference;return n?{spatialReference:l.find(v=>n.equals(v))??l[0]??null,updating:!1}:{spatialReference:l[0],updating:!1}}function p(e){return e?!e.loaded&&e.resourceInfo?x(e.resourceInfo.data):{baseLayers:y(e.baseLayers),referenceLayers:y(e.referenceLayers)}:null}function y(e){return(g.isCollection(e)?e.toArray():e).map(h)}function h(e){var a,t;return{type:e.type,url:m("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl||""),minScale:"minScale"in e&&e.minScale!=null?e.minScale:0,maxScale:"maxScale"in e&&e.maxScale!=null?e.maxScale:0,opacity:e.opacity!=null?e.opacity:1,visible:e.visible==null||!!e.visible,sublayers:e.type!=="map-image"&&e.type!=="wms"||!i(e.sublayers)||(a=e.sublayers)==null?void 0:a.map(l=>({id:l.id,visible:l.visible})),activeLayerId:e.type==="wmts"?(t=e.activeLayer)==null?void 0:t.id:void 0}}function x(e){return e?{baseLayers:d((e.baseMapLayers??[]).filter(a=>!a.isReference)),referenceLayers:d((e.baseMapLayers??[]).filter(a=>a.isReference))}:null}function d(e){return e.map(a=>I(a))}function I(e){let a;switch(e.layerType){case"VectorTileLayer":a="vector-tile";break;case"ArcGISTiledMapServiceLayer":a="tile";break;default:a="unknown"}return{type:a,url:m(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:e.minScale!=null?e.minScale:0,maxScale:e.maxScale!=null?e.maxScale:0,opacity:e.opacity!=null?e.opacity:1,visible:e.visibility==null||!!e.visibility,sublayers:void 0,activeLayerId:void 0}}function $(e,a,t){return e!=null!=(a!=null)?"not-equal":!e||!a?"equal":b(e.baseLayers,a.baseLayers)?b(e.referenceLayers,a.referenceLayers)?"equal":t.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal"}function b(e,a){if(e.length!==a.length)return!1;for(let t=0;t<e.length;t++)if(!q(e[t],a[t]))return!1;return!0}function q(e,a){if(e.type!==a.type||e.type==="scene"||e.url!==a.url||e.minScale!==a.minScale||e.maxScale!==a.maxScale||e.visible!==a.visible||e.opacity!==a.opacity)return!1;if(i(e.activeLayerId)||i(a.activeLayerId))return e.activeLayerId===a.activeLayerId;if(i(e.sublayers)||i(a.sublayers)){if(s(e.sublayers)||s(a.sublayers)||e.sublayers.length!==a.sublayers.length)return!1;for(let t=0;t<e.sublayers.length;t++){const l=e.sublayers.at(t),n=a.sublayers.at(t);if((l==null?void 0:l.id)!==(n==null?void 0:n.id)||(l==null?void 0:l.visible)!==(n==null?void 0:n.visible))return!1}}return!0}function m(e){return e?R(e).replace(/^\s*https?:/i,"").toLowerCase():""}export{k as L,A as h,j as m,U as p,M as y};
