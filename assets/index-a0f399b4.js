var L=Object.defineProperty;var q=(e,n,t)=>n in e?L(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;var c=(e,n,t)=>(q(e,typeof n!="symbol"?n+"":n,t),t);import{hS as x,hT as A}from"./index-c754ff65.js";function I(e,n){return{x:e,y:n,spatialReference:{wkid:4326}}}function R(e){const n=new URLSearchParams;for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){let r=e[t];r==null?r="":typeof r=="object"&&(r=JSON.stringify(r)),n.set(t,typeof r=="string"?r:`${r}`)}return n}async function D(e,n,t){const r={f:"json",geometry:I(e,n),geometryType:"esriGeometryPoint",returnGeometry:!1};/\/identify\/?$/.test(t)||(t=t.replace(/\/?$/,"/identify")),t=[t,R(r)].join("?");const o=(await(await fetch(t)).json()).value,s=parseFloat(o);return isNaN(s)?o:s}function j(e){return e!=null&&e>0}function P(e,n){return e!=null?e-n:null}function $(e,n,t){return e!=null?n-(t||0):null}function F(e){if(e===null)return null;if(typeof e=="number"){if(isNaN(e))throw new TypeError("Input surface elevation cannot NaN.");return e}if(e==="NoData")throw new TypeError("Surface elevation has no data.");{const n=parseFloat(e);if(isNaN(n))throw new TypeError(`Input string is not a number: ${e}`);return n}}class O extends Object{constructor(t,r,a){super();c(this,"agl");c(this,"terrainElevation");c(this,"_surfaceElevation");this.agl=t,this.terrainElevation=a,this._surfaceElevation=F(r)}get surfaceElevation(){return this._surfaceElevation}get distanceFromSurface(){return this.surfaceElevation===null?null:P(this.surfaceElevation,this.terrainElevation)}get penetrationOfSurface(){return this.surfaceElevation==null||this.distanceFromSurface==null?null:$(this.surfaceElevation,this.agl,this.distanceFromSurface)}get penetratesSurface(){return j(this.penetrationOfSurface)}toString(){return x(this)}}async function M(e,n,t,r,a){const i=A({x:e,y:n,units:"Feet",includeDate:!0,wkid:4326},a),o=D(e,n,r),[s,m]=await Promise.all([i,o]);return{surfacePenetration:new O(t,m,s.value),terrainInfo:s,xy:[e,n]}}const _=/^(-?\d+(?:\.\d+)?)[°:d]?\s?(?:(\d+(?:\.\d+)?)['′ʹ:]?\s?(?:(\d+(?:\.\d+)?)["″ʺ]?)?)?\s?([NSEW])?/i;function C(e){return e>0?Math.floor(e):Math.ceil(e)}class w{constructor(n,t){c(this,"_dd");c(this,"_hemisphere");this._dd=n,this._hemisphere=/^[WE]|(?:lon)/i.test(t)?n<0?"W":"E":n<0?"S":"N"}get dd(){return this._dd}get hemisphere(){return this._hemisphere}getDmsArray(){return this.dmsArray}get dmsArray(){const n=Math.abs(this._dd),t=C(n),r=C((n-t)*60),a=(n-t-r/60)*Math.pow(60,2);return[t,r,a,this._hemisphere]}toString(n){const t=this.getDmsArray(),r=isNaN(Number(n))?t[2]:t[2].toFixed(n);return`${t[0]}°${t[1]}′${r}″ ${t[3]}`}}class f{constructor(n,t){c(this,"lat");c(this,"lon");c(this,"_longitude");c(this,"_latitude");if(this.lat=n,this.lon=t,typeof n!="number"||typeof t!="number")throw TypeError("The longitude and latitude parameters must be numbers.");if(isNaN(t)||t<-180||t>180)throw RangeError("longitude must be between -180 and 180");if(isNaN(n)||n<-90||n>90)throw RangeError("latitude must be between -90 and 90");this._longitude=new w(t,"long"),this._latitude=new w(n,"lat")}get longitude(){return this._longitude}get latitude(){return this._latitude}getDmsArrays(){return this.dmsArrays}get dmsArrays(){return{longitude:this.longitude.dmsArray,latitude:this.latitude.dmsArray}}toString(){return[this.latitude,this.longitude].join(", ")}}c(f,"dmsRe",_);function y(e){let n=NaN;const t=_.exec(e);if(t){const r=Number(t[1]),a=typeof t[2]<"u"?Number(t[2])/60:0,i=typeof t[3]<"u"?Number(t[3])/3600:0,o=t[4]||null;o!==null&&/[SW]/i.test(o)?n=-Math.abs(r)-a-i:n=r+a+i}return n}const S="coordinates-update",T="calculation-complete",k="calculation-error";function v(e){e=e||{};const n=document.createElement("button");n.type=e.type||"button",e.title&&(n.title=e.title);const t=document.createElement("span");t.classList.add("icon"),typeof e.iconClass=="string"?t.classList.add(e.iconClass):Array.isArray(e.iconClass)&&t.classList.add(...e.iconClass);const r=document.createElement("span");return r.classList.add("caption"),typeof e.caption=="string"?r.textContent=e.caption:e.caption instanceof HTMLElement&&r.appendChild(e.caption),n.appendChild(t),n.appendChild(r),n}function N(e,...n){let t=document.getElementById(e);if(t)return!0;if(!n||!n.length)return!1;for(const r of n)if(t=r.querySelector(`#${e}`),t)return!0;return!1}function B(e,...n){if(e==null&&(e="id"),!N(e))return e;let t=e,r=0;for(;N(t,...n);)r++,t=`${e}${r}`;return t}function b(e,...n){e=e||{};const t=document.createDocumentFragment();if(e.id=B(e.name,...n),e.label){const i=document.createElement("label");i.textContent=e.label,i.htmlFor=e.id,t.appendChild(i)}const r=document.createElement("input");r.required=typeof e.required=="boolean"?e.required:!!e.required;const a=/^(?:(?:label)|(?:required))$/i;for(const i in e){if(!Object.prototype.hasOwnProperty.call(e,i))continue;const o=e[i];if(o==null||a.test(i))continue;const s=o;s instanceof RegExp?r.setAttribute(i,s.source):typeof s!="string"?r[i]=s:r.setAttribute(i,s)}return t.appendChild(r),t}class W{constructor(n,t){c(this,"imageServiceUrl");c(this,"elevationServiceUrl");c(this,"_form");this.imageServiceUrl=n,this.elevationServiceUrl=t;const r=()=>{const l=y(this._form.x.value),p=y(this._form.y.value);let d;try{d=new f(p,l)}catch{d=null}const h=new CustomEvent(S,{detail:d});this._form.dispatchEvent(h)},a=document.createElement("form");this._form=a,a.classList.add("airspace-calculator");const i=document.createElement("div");i.classList.add("container");let o=b({label:"Longitude",name:"x",type:"text",pattern:f.dmsRe.source,placeholder:"longitude",title:"Longitude in dec. degrees or DMS format.",required:"required",autocomplete:"on"},i),s=document.createElement("div");s.appendChild(o),i.appendChild(s),o=b({label:"Latitude",name:"y",type:"text",pattern:f.dmsRe.source,placeholder:"latitude",title:"Latitude in dec. degrees or DMS format.",required:"required",autocomplete:"on"},i),s=document.createElement("div"),s.appendChild(o),i.appendChild(s),o=b({label:"Structure Height",name:"height",type:"number",placeholder:"Structure Height",title:"Enter a structure height in feet",min:1,required:"required"},i),s=document.createElement("div"),s.appendChild(o),i.appendChild(s),a.appendChild(i);const m=document.createElement("div");m.classList.add("map-buttons");let u=v({caption:"Get coords. from map",title:"Pick coordinates by clicking a location on the map",iconClass:["fa","fa-location-arrow"]});m.appendChild(u),u.addEventListener("click",()=>{const l=new CustomEvent("add-from-map",{detail:null});a.dispatchEvent(l)}),u=v({caption:"Clear Graphics",title:"Clears graphics from the map created by this control",iconClass:["fa","fa-trash"]}),m.appendChild(u),u.addEventListener("click",()=>{const l=new CustomEvent("clear-graphics",{detail:null});a.dispatchEvent(l)}),a.appendChild(m),s=document.createElement("div"),s.classList.add("btn-group"),u=v({type:"submit",caption:"Calculate",title:"Begin the calculation"}),s.appendChild(u),u=v({type:"reset",caption:"Reset",title:"Resets the form"}),s.appendChild(u),a.appendChild(s);for(const l of[a.x,a.y])l.addEventListener("blur",r);a.onsubmit=()=>{const l=y(a.x.value),p=y(a.y.value);let d;try{d=new f(p,l)}catch{d=null,alert("Invalid coordinates")}if(d){const h=Number(a.height.value);M(l,p,h,this.imageServiceUrl,this.elevationServiceUrl).then(g=>{const E=new CustomEvent(T,{detail:g});a.dispatchEvent(E)},g=>{const E=new CustomEvent(k,{detail:g});a.dispatchEvent(E)})}return!1},a.addEventListener("reset",()=>{const l=new CustomEvent(S,{detail:null});a.dispatchEvent(l)})}get form(){return this._form}}export{T as calculationCompleteEventName,k as calculationErrorEventName,S as coordinatesUpdateEventName,W as default};
